(this.webpackJsonpCSN=this.webpackJsonpCSN||[]).push([[0],{108:function(t,e,a){},109:function(t,e,a){},125:function(t,e,a){},126:function(t,e,a){},135:function(t,e,a){"use strict";a.r(e);var i=a(0),s=a.n(i),n=a(24),r=a.n(n),o=(a(108),a(70)),c=a(8),l=(a(109),a(6)),h=a(4),d=a(9),u=a(10),p=a(23),g=a(15),v=a(81),m=a(2),b=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={dimensions:{},imgURL:null},i.onImgLoad=i.onImgLoad.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.props.setPreviewPaneCanvas(this.side_canvas)}},{key:"onImgLoad",value:function(t){var e=t.target;this.setState({dimensions:{height:e.offsetHeight,width:e.offsetWidth}})}},{key:"componentWillUpdate",value:function(t){var e=this;this.state.imgURL!==t.prevURL&&(null!==this.state.imgURL&&this.setState({imgURL:null}),this.textTimer&&clearTimeout(this.textTimer),this.textTimer=setTimeout((function(){e.setState({imgURL:t.prevURL})}),10))}},{key:"render",value:function(){var t=this,e=this.props.previewPane_image_size,a=this.state.dimensions,i="auto",s="100%";return a.width>=a.height&&(i="100%",s="auto"),Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{style:{position:"absolute",width:e,height:e,textAlign:"center"},children:[Object(m.jsx)("span",{style:{display:"inline-block",height:"100%",verticalAlign:"middle"}}),Object(m.jsx)("img",{src:this.state.imgURL,onLoad:this.onImgLoad,alt:"",style:{verticalAlign:"middle",width:i,height:s}})]}),Object(m.jsx)("canvas",{ref:function(e){t.side_canvas=e},width:e,height:e})]})}}]),a}(i.Component),f=s.a.memo(b),j=a(168),x=a(170),O=a(50),y=a(12),w=a(167),_=a(11),S=12;var C=Object(_.a)((function(t){return{rail:{backgroundColor:t.palette.grey[400],width:"100%",height:2,position:"absolute",pointerEvents:"none"},railHotspot:{width:"100%",height:24,top:-12,position:"absolute",cursor:"pointer"}}}))((function(t){var e=t.classes,a=t.getRailProps;return Object(m.jsxs)(i.Fragment,{children:[Object(m.jsx)("div",Object(p.a)({className:e.railHotspot},a())),Object(m.jsx)("div",{className:e.rail})]})}));var k=Object(_.a)((function(t){return{root:{backgroundColor:t.palette.secondary.main,marginLeft:-6,marginTop:-6,width:S,height:S,border:0,borderRadius:"50%",whiteSpace:"nowrap",position:"absolute",zIndex:2,cursor:"pointer"}}}))((function(t){var e=Object(y.a)(t.domain,2),a=e[0],i=e[1],s=t.handle,n=s.id,r=s.value,o=s.percent,c=t.classes,l=t.getHandleProps;return Object(m.jsx)("div",Object(p.a)({role:"slider","aria-valuemin":a,"aria-valuemax":i,"aria-valuenow":r,className:c.root,style:{left:"".concat(o,"%")}},l(n)))}));var P=Object(_.a)((function(t){return{track:{backgroundColor:t.palette.secondary.main,height:2,position:"absolute",zIndex:1,pointerEvents:"none"},trackHotspot:{height:S,top:-6,position:"absolute",cursor:"pointer"}}}))((function(t){var e=t.classes,a=t.source,s=t.target,n=t.getTrackProps,r="".concat(a.percent,"%"),o="".concat(s.percent-a.percent,"%");return Object(m.jsxs)(i.Fragment,{children:[Object(m.jsx)("div",{className:e.track,style:{left:r,width:o}}),Object(m.jsx)("div",Object(p.a)({className:e.trackHotspot,style:{left:r,width:o}},n()))]})}));function D(t){var e=t.classes,a=t.tick,i=t.count,s=t.format;return Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:e.tick,style:{left:"".concat(a.percent,"%")}}),Object(m.jsx)(w.a,{className:e.label,variant:"caption",style:{marginLeft:"".concat(-100/i/2,"%"),width:"".concat(100/i,"%"),left:"".concat(a.percent,"%")},children:s(a.value)})]})}D.defaultProps={format:function(t){return t}};Object(_.a)((function(t){return{tick:{position:"absolute",marginTop:14,width:1,height:5,backgroundColor:t.palette.grey[400]},label:{position:"absolute",marginTop:22,textAlign:"center"}}}))(D);var z=a(71),A=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={isHovering:!1,barSelected:null},i.onLeave=i.onLeave.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"calculateHistogram",value:function(t,e){for(var a=[],i=0;i<this.props.settings.total;i++)0===this.props.currentProjection[i]&&a.push(this.props.metadata[i][this.props.sliderID]);var s={};this.bucketsFinder={};var n,r;n=t[0]<0?(Math.abs(t[0])+Math.abs(t[1]))/50:Math.abs((Math.abs(t[0])-Math.abs(t[1]))/50);for(var o=0;o<50;o++)s[o]=0;for(var c=0;c<a.length;c++)s[r=a[c]===t[1]?49:(a[c]-t[0])/n|0]+=1,this.bucketsFinder[parseFloat(a[c]).toFixed(1)]=r;var l=Object.values(s);if(!0===e){var h=Math.max.apply(Math,l)/50;for(c=0;c<l.length;c++)l[c]=Math.round(l[c]/h)}for(var d=[],u=0;u<l.length;u++)d.push(l[u]||0);return d}},{key:"hoverEffect",value:function(t){if(this.setState({isHovering:!0}),t[0]){var e=t[0].index,a=new Float32Array(this.props.settings.total).fill(1),i=this.props.currentProjection;this.props.barData.selections[e].forEach((function(t){a[t]=i[t]})),this.props.calculateProjection(a,null,!1),this.setState({barSelected:e})}}},{key:"onLeave",value:function(){this.setState({isHovering:!1}),this.props.calculateProjection(this.props.currentProjection,null,!1)}},{key:"render",value:function(){var t=this,e=this.props,a=e.barData,i=e.domain,s=e.color,n=e.selected;z.b.animation=!1;var r=Array(50).fill(0);this.barDataSoll=a.histogram,this.barDataIst=this.calculateHistogram(i,!1);var o={labels:this.barDataSoll.map((function(t,e){return e})),datasets:[{label:"barDataIst",type:"bar",barThickness:5,normalized:!0,order:2,backgroundColor:this.state.isHovering?"rgb(64, 64, 64)":r.map((function(e,a){return a===t.bucketsFinder[parseFloat(n).toFixed(1)]?"#f50057":s})),hoverBackgroundColor:s,data:this.barDataIst},{label:"barDataSoll",type:"bar",barThickness:5,normalized:!0,order:3,backgroundColor:r.map((function(e,a){return a===t.bucketsFinder[parseFloat(n).toFixed(1)]?"#542032":"rgb(64, 64, 64)"})),hoverBackgroundColor:"rgb(64, 64, 64)",data:this.barDataSoll}]},c={responsive:!0,interaction:{mode:"index",intersect:!1},events:["mouseleave","mousemove","mouseout","click"],hoverBackgroundColor:s,onClick:function(){t.setState({isHovering:!t.state.isHovering}),t.props.calculateProjection(t.props.currentProjection,null,!1)},onHover:function(e,a){"mousemove"===e.type&&t.state.isHovering&&t.state.barSelected!==a[0].index?(t.setState({bgColor:"rgb(64, 64, 64)"}),t.hoverEffect(a),"ew-resize"!==e.native.target.style.cursor&&(e.native.target.style.cursor="ew-resize")):t.state.isHovering||"pointer"===e.native.target.style.cursor||(e.native.target.style.cursor="pointer")},plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1,stacked:!0},yAxes:{beginAtZero:!0,display:!1}}};return Object(m.jsx)(z.a,{data:o,height:62,options:c,onMouseLeave:this.onLeave})}}]),a}(s.a.Component),F=s.a.memo(A),M=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;Object(l.a)(this,a),i=e.call(this,t);var s=t.datafilter,n=[Math.min.apply(null,s),Math.max.apply(null,s)];return i.state={domain:n,update:n,values:n,inputValues:n,typeNumber:i.props.typeNumber,step:t.step,color:t.color,hover_index:i.props.hover_index,isToggleOn:!1},i.changeSlider=i.changeSlider.bind(Object(g.a)(i)),i.currentValues=n,i.handleClick=i.handleClick.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"handleClick",value:function(t){this.setState((function(t){return{isToggleOn:!t.isToggleOn}})),t.stopPropagation()}},{key:"changeSlider",value:function(t){this.currentValues=t,this.props.onChangeSlider(this.props.title,t)}},{key:"render",value:function(){var t=this,e=this.state,a=e.domain,i=e.values,s=e.update,n=e.inputValues,r=e.color,o=e.typeNumber;return Object(m.jsx)(j.a,{container:!0,children:Object(m.jsx)(j.a,{item:!0,xs:12,children:Object(m.jsxs)("div",{style:{height:"90px",width:"270px",marginTop:"12px"},children:[Object(m.jsx)(F,{update:s,domain:a,color:r,barData:this.props.barData,calculateProjection:this.props.calculateProjection,settings:this.props.settings,currentProjection:this.props.currentProjection,sliderID:this.props.sliderID,metadata:this.props.metadata,selected:this.props.metadata[this.props.hover_index][this.props.sliderID]}),Object(m.jsxs)(O.c,{mode:3,step:"int"===o?1:.01,domain:a,color:r,rootStyle:{position:"relative",width:"100%"},onUpdate:function(e){t.setState({update:e,inputValues:e})},onChange:function(e){t.setState({values:e}),t.changeSlider(s)},values:i,children:[Object(m.jsx)(O.b,{children:function(t){var e=t.getRailProps;return Object(m.jsx)(C,{getRailProps:e})}}),Object(m.jsx)(O.a,{children:function(t){var e=t.handles,i=t.getHandleProps;return Object(m.jsx)("div",{className:"slider-handles",children:e.map((function(t){return Object(m.jsx)(k,{handle:t,domain:a,getHandleProps:i},t.id)}))})}}),Object(m.jsx)(O.d,{left:!1,right:!1,children:function(t){var e=t.tracks,a=t.getTrackProps;return Object(m.jsx)("div",{className:"slider-tracks",children:e.map((function(t){var e=t.id,i=t.source,s=t.target;return Object(m.jsx)(P,{source:i,target:s,getTrackProps:a},e)}))})}})]}),Object(m.jsxs)(j.a,{container:!0,alignItems:"center",justifyContent:"space-around",children:[Object(m.jsx)(j.a,{item:!0,xs:4,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto",marginTop:10},children:Object(m.jsx)(x.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",value:n[0],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:function(e){var i=e.target.value,s=[i,n[1]];t.setState({inputValues:s}),i&&i>=a[0]&&t.setState({values:s})}})}),Object(m.jsx)(j.a,{item:!0,xs:4,style:{textAlign:"center",marginTop:"6px"},children:Object(m.jsxs)("div",{className:"tooltip",children:[Object(m.jsx)("button",{onClick:this.handleClick,children:Object(m.jsx)("a",{href:"#",style:{color:"#00cc55",cursor:"help",textSize:"8px"},children:this.state.isToggleOn?"close":this.props.title})}),this.state.isToggleOn?Object(m.jsx)("span",{className:"tooltiptext",children:this.props.info}):null]})}),Object(m.jsx)(j.a,{item:!0,xs:4,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto",marginTop:10},children:Object(m.jsx)(x.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",value:n[1],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:function(e){var s=e.target.value,r=[n[0],s];t.setState({inputValues:r}),s&&s<=a[1]&&s>=i[0]&&t.setState({values:r})}})})]})]})})})}}]),a}(s.a.Component),T=s.a.memo(M),L=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;for(var n in Object(l.a)(this,a),(i=e.call(this,t)).changeSlider=i.changeSlider.bind(Object(g.a)(i)),i.slidersAr=[],i.props.settings.sliders)i.slidersAr.push(i.props.settings.sliders[n].id);i.refSliders={},i.filterData={},i.filtered={};for(var r=0;r<i.slidersAr.length;r+=1){i.refSliders[i.slidersAr[r]]=s.a.createRef();var o=[];for(var c in i.props.metadata)o.push(i.props.metadata[c][i.slidersAr[r]]);i.filterData[i.slidersAr[r]]=o}return i.state={datafilter:i.filterData},i}return Object(h.a)(a,[{key:"changeSlider",value:function(t,e){console.log(t,e);var a=this.props.metadata;this.filtered[t]=new Float32Array(this.props.settings.total).fill(0);var i=new Float32Array(this.props.settings.total);for(var s in a)(e[0]>a[s][t]||e[1]<a[s][t])&&(this.filtered[t][s]=1);var n=Object.values(this.filtered),r=i.map((function(t,e){return n.reduce((function(t,a){return t+a[e]}),0)}));this.props.calculateProjection(r,"filter",!0)}},{key:"render",value:function(){var t=this,e=this.props,a=e.hover_index,i=e.settings,s=e.barData,n=i.sliders.map((function(e){return Object(m.jsx)(j.a,{item:!0,children:Object(m.jsx)(T,{ref:t.refSliders[e.id],datafilter:t.state.datafilter[e.id],title:e.title,info:e.info,typeNumber:e.typeNumber,color:e.color,onChangeSlider:t.changeSlider,hover_index:a,barData:s[e.id],calculateProjection:t.props.calculateProjection,currentProjection:t.props.currentProjection,settings:i,sliderID:e.id,metadata:t.props.metadata})})}));return Object(m.jsx)(j.a,{container:!0,style:{marginLeft:"6px"},children:Object(m.jsx)(j.a,{item:!0,children:n})})}}]),a}(i.Component),N=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).sliderReset=i.sliderReset.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"sliderReset",value:function(){console.log("reset range sliders")}},{key:"render",value:function(){var t=this.props,e=t.metadata,a=t.hover_index;return Object(m.jsx)(L,{metadata:e,settings:this.props.settings,hover_index:a,barData:this.props.barData,filterImageAr:this.props.filterImageAr,calculateProjection:this.props.calculateProjection,currentProjection:this.props.currentProjection})}}]),a}(i.Component),H=s.a.memo(N),I=a(27),R=a(21),E=a(31),U=a.n(E),V=a(173),Z=a(62),q=a.n(Z),W=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(h.a)(a,[{key:"needOperators",value:function(t){return Object(I.a)(Object(R.a)(a.prototype),"needOperators",this).call(this,t).concat(["startsWith"])}}]),a}(Z.GridDataAutoCompleteHandler),B=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(h.a)(a,[{key:"filter",value:function(t,e,a,i){var s=this.tryToGetFieldCategory(e);switch(a){case"==":return t[s]===i;case"!=":return t[s]!==i;case"contains":return t[s].toLowerCase().indexOf(i.toLowerCase())>=0;case"!contains":return t[s].toLowerCase().indexOf(i.toLowerCase())<0;case"startsWith":return U.a.startsWith(t[s].toLowerCase(),i.toLowerCase());default:return!1}}}]),a}(Z.SimpleResultProcessing),G=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={parseOK:!0,query2:{}},i.applyFilter=i.applyFilter.bind(Object(g.a)(i)),i.resetFilter=i.resetFilter.bind(Object(g.a)(i)),i.options=i.props.settings.search,i.customAutoComplete=new W(i.props.metadata,i.options),i}return Object(h.a)(a,[{key:"applyFilter",value:function(){var t=new B(this.options).process(this.props.metadata,this.state.query2),e=new Float32Array(this.props.settings.total).fill(1);t.forEach((function(t){e[t.index]=0})),this.props.calculateProjection(e,"search",!0)}},{key:"resetFilter",value:function(){this.setState({query:null,query2:""});var t=new Float32Array(this.props.settings.total).fill(0);this.props.calculateProjection(t,"search",!0)}},{key:"customRenderCompletionItem",value:function(t,e,a){var i=" hint-value cm-".concat(e.type);return Object(m.jsxs)("div",{className:i,children:[Object(m.jsx)("span",{style:{fontWeight:"bold"},children:e.value}),Object(m.jsxs)("span",{style:{color:"gray",fontSize:10},children:[" [",e.type,"] "]})]})}},{key:"onParseOk",value:function(t){this.setState({parseOK:!1}),this.setState({query2:t})}},{key:"onParseError",value:function(t){this.setState({parseOK:!0})}},{key:"render",value:function(){return Object(m.jsxs)("div",{className:"main-container",children:[Object(m.jsx)(q.a,{autoCompleteHandler:this.customAutoComplete,customRenderCompletionItem:this.customRenderCompletionItem.bind(this),query:this.state.query,data:this.props.metadata,options:this.options,onParseOk:this.onParseOk.bind(this),onParseError:this.onParseError.bind(this),editorConfig:{lineWrapping:!0}}),Object(m.jsx)(V.a,{variant:"contained",disabled:this.state.parseOK,onClick:this.applyFilter,children:"apply"}),Object(m.jsx)(V.a,{variant:"contained",onClick:this.resetFilter,children:"reset"})]})}}]),a}(i.Component),K=(a(125),function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){var t=this.props,e=t.metadata,a=t.settings;return Object(m.jsx)(j.a,{container:!0,spacing:2,children:Object(m.jsx)(G,{calculateProjection:this.props.calculateProjection,settings:a,metadata:e,currentProjection:this.props.currentProjection,allFilter:this.props.allFilter})})}}]),a}(i.Component)),J=s.a.memo(K),Y=a(49),$=a.n(Y),Q=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={},i}return Object(h.a)(a,[{key:"render",value:function(){var t=this.props,e=t.metadata,a=t.hover_index,s=t.infos.map((function(t){return Object(m.jsxs)(i.Fragment,{children:[Object(m.jsxs)(j.a,{item:!0,xs:4,children:[t,":"]},$()()),Object(m.jsx)(j.a,{item:!0,xs:8,children:e[a][t]},$()())]})}));return Object(m.jsxs)(j.a,{container:!0,justifyContent:"space-between",spacing:1,wrap:"wrap",children:[Object(m.jsx)(j.a,{item:!0,xs:12,children:Object(m.jsx)("b",{children:e[a].Title})},$()()),s]},$()())}}]),a}(i.Component),X=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={dimensions:{}},i}return Object(h.a)(a,[{key:"render",value:function(){var t=this.props,e=t.hover_index,a=t.infos,i=t.metadata;return Object(m.jsx)(Q,{metadata:i,hover_index:e,infos:a})}}]),a}(i.Component),tt=s.a.memo(X),et=a(172),at=a(174),it=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={dimensions:{}},i}return Object(h.a)(a,[{key:"render",value:function(){var t=this.props.clusters;return Object(m.jsxs)(j.a,{container:!0,spacing:1,children:[Object(m.jsx)(j.a,{item:!0,xs:4,children:"clusters:"}),Object(m.jsx)(j.a,{item:!0,xs:8,children:Object(m.jsxs)("select",{onChange:this.props.handleChangeCluster,children:[Object(m.jsx)("option",{value:"0",children:"-"},"0"),t.clusterList.map((function(t,e){return Object(m.jsx)("option",{value:t,children:t},t)}))]})}),Object(m.jsx)(j.a,{item:!0,xs:4,children:"size (out):"}),Object(m.jsx)(j.a,{item:!0,xs:8,children:Object(m.jsx)(et.a,{height:10,children:Object(m.jsx)(at.a,{size:"small",defaultValue:this.props.scaleMin,min:3,max:60,onChange:this.props.handleChangeScale})})}),Object(m.jsx)(j.a,{item:!0,xs:4,children:"size (in):"}),Object(m.jsx)(j.a,{item:!0,xs:8,children:Object(m.jsx)(et.a,{height:10,children:Object(m.jsx)(at.a,{size:"small",defaultValue:this.props.scaleMax,min:3,max:120,onChange:this.props.handleChangeZoom})})})]})}}]),a}(i.Component),st=s.a.memo(it),nt=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).handleSelectAlgorithm=i.handleSelectAlgorithm.bind(Object(g.a)(i)),i.handleSelectDataset=i.handleSelectDataset.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"handleSelectAlgorithm",value:function(t){var e=t.target.value;this.props.selectAlgorithm(e)}},{key:"handleSelectDataset",value:function(t){var e=t.target.value;this.props.selectDataset(e)}},{key:"render",value:function(){var t=this.props,e=t.algorithm_options,a=t.algorithm_choice,i=t.dataset_options,s=t.selectedDataset,n=t.datasetInfo;return Object(m.jsxs)(j.a,{container:!0,spacing:1,children:[Object(m.jsx)(j.a,{item:!0,xs:6,children:"Dataset:"}),Object(m.jsx)(j.a,{item:!0,xs:6,children:"Mapping:"}),Object(m.jsx)(j.a,{item:!0,xs:6,children:Object(m.jsx)("select",{className:"full-width",onChange:this.handleSelectDataset,value:s,children:i.map((function(t,e){return Object(m.jsx)("option",{value:t,children:t},t)}))})}),Object(m.jsx)(j.a,{item:!0,xs:6,children:Object(m.jsx)("select",{className:"full-width",onChange:this.handleSelectAlgorithm,value:e[a],children:e.map((function(t,e){return Object(m.jsx)("option",{value:t,children:t},t)}))})}),Object(m.jsx)(j.a,{item:!0,xs:12,children:Object(m.jsx)("p",{className:"info",children:n})})]})}}]),a}(i.Component),rt=s.a.memo(nt),ot=a(29),ct=(a(126),a(16)),lt=a(18),ht=a(32),dt=a(63),ut=a(169),pt=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).handleResize=function(t,e){i.camera.aspect=t/e,i.camera.updateProjectionMatrix(),i.renderer.setSize(t,e);var a=i.getScaleFromZ(i.camera.position.z),s=-i.camera.position.x*a+i.props.width/2,n=i.camera.position.y*a+i.props.height/2,r=ht.f.translate(s,n).scale(a),o=ht.d(i.mount);i.d3_zoom.transform(o,r)},i.updateProjection=function(t){i.filterAr=t;for(var e=[],a=[],s=0;s<i.props.settings.sprite_number;s++){var n=s*i.sprite_size,r=(s+1)*i.sprite_size;s===i.props.settings.sprite_number-1&&(r=i.props.settings.sprite_number*i.sprite_size),e.push([n,r]),a.push(t.slice(n,r))}for(var o=0;o<i.props.settings.sprite_number;o++){var c=i.scene.children[0].children[o];c.geometry.attributes.color=new lt.a(a[o],1),c.geometry.attributes.color.needsUpdate=!0}var l=i.scene.children[0].children[0];console.log(l.geometry)},i.updateClusterColors=function(t){console.log("updateClusterColors",t);var e=i.props.settings.sprite_number*i.sprite_size,a=new Float32Array(3*e),s=new Float32Array(e),n=i.props.settings.clusters.clusterColors;console.log(e,"-"!==t,i.props.settings.total,n);for(var r=0,o=0,c=e;r<c;r++,o+=1)if("-"!==t&&r<i.props.settings.total){s[o]=1,console.log(s[o]);var l=i.props.metadata[o][t];l>=n.length?(a[3*o]=1,a[3*o+1]=1,a[3*o+2]=1):(a[3*o]=n[l][0],a[3*o+1]=n[l][1],a[3*o+2]=n[l][2])}else s[o]=0;for(var h=[],d=[],u=[],p=0;p<i.props.settings.sprite_number;p++){var g=p*i.sprite_size,v=(p+1)*i.sprite_size;p===i.props.settings.sprite_number-1&&(v=i.props.settings.sprite_number*i.sprite_size),h.push([g,v]),d.push(s.slice(g,v)),u.push(a.slice(g,3*v))}for(var m=0;m<i.props.settings.sprite_number;m++){var b=i.scene.children[0].children[m];b.geometry.attributes.clusters=new lt.a(u[m],3),b.geometry.attributes.clusters.needsUpdate=!0,b.geometry.attributes.clustersActive=new lt.a(d[m],1),b.geometry.attributes.clustersActive.needsUpdate=!0}},i.loadTiles(),i.state={tilesLoaded:0,view:null},i.init=i.init.bind(Object(g.a)(i)),i.pointsAr=[],i.addPoints=i.addPoints.bind(Object(g.a)(i)),i.handleResize=i.handleResize.bind(Object(g.a)(i)),i.setupCamera=i.setupCamera.bind(Object(g.a)(i)),i.animate=i.animate.bind(Object(g.a)(i)),i.getScaleFromZ=i.getScaleFromZ.bind(Object(g.a)(i)),i.getZFromScale=i.getZFromScale.bind(Object(g.a)(i)),i.changeEmbeddings=i.changeEmbeddings.bind(Object(g.a)(i)),i}return Object(h.a)(a,[{key:"loadTiles",value:function(){var t=this;this.sprite_size=this.props.settings.sprite_side*this.props.settings.sprite_side,this.tile_locations=Object(ct.a)(Array(this.props.settings.sprite_number)).map((function(e,a){return"".concat("/CSN","/datasets/").concat(t.props.datasetDir,"/tile_").concat(a,".png")})),this.datasetIMG=this.tile_locations.map((function(t){var e=document.createElement("img");return e.src=t,e}))}},{key:"changeEmbeddings",value:function(t,e){for(var a=this,i=[],s=0;s<this.props.settings.sprite_number;s++){var n=s*this.sprite_size,r=(s+1)*this.sprite_size;s===this.props.settings.sprite_number-1&&(r=this.props.settings.sprite_number*this.sprite_size),i.push([n,r])}for(var o=i.map((function(t){return a.props.mappings[e].slice(t[0],t[1])})),c=function(t){for(var e=o[t],i=a.scene.children[0].children[t],s=e.length,n=i.geometry.attributes.position.array,r=new Float32Array(3*s),c=0,l=0,h=s;c<h;c++,l+=3){var d=e[c][0],u=e[c][1];r[l]=d,r[l+1]=u,r[l+2]=0}var p=new dt.Tween(n).to(r,1e3).easing(dt.Easing.Linear.None);p.onUpdate((function(){i.geometry.attributes.position=new lt.a(n,3),i.geometry.attributes.position.needsUpdate=!0})),p.start()},l=0;l<this.props.settings.sprite_number;l++)c(l)}},{key:"zoomScaler",value:function(t){return ht.c().domain([20,0]).range([this.props.scaleMin,this.props.scaleMax]).clamp(!0)(t)}},{key:"getZFromScale",value:function(t){var e=lt.d.degToRad(this.camera.fov);return this.props.height/t/(2*Math.tan(e/2))}},{key:"getScaleFromZ",value:function(t){var e=lt.d.degToRad(this.camera.fov),a=2*(Math.tan(e/2)*t);return this.props.height/a}},{key:"zoomHandler",value:function(){var t=ht.a.transform,e=t.k,a=-(t.x-this.props.width/2)/e,i=(t.y-this.props.height/2)/e,s=this.getZFromScale(e);this.camera.position.set(a,i,s);for(var n=this.zoomScaler(s),r=this.scene.children[0].children,o=0;o<r.length;o++)r[o].material.uniforms.size.value=n}},{key:"setupCamera",value:function(){var t,e=this.props,a=e.width,i=e.height,s=e.embeddings_data,n=this.camera.fov,r=lt.d.degToRad(n),o=s.map((function(t){return t[0]})),c=E.min(o),l=E.max(o),h=s.map((function(t){return t[1]})),d=E.min(h),u=E.max(h),p=E.max([c,l].map((function(t){return Math.abs(t)}))),g=E.max([d,u].map((function(t){return Math.abs(t)}))),v=1.25*(t=Math.max(p,g)/Math.tan(r/2));this.camera.far=v,this.camera.position.z=1.1*t,this.d3_zoom=ht.e().scaleExtent([this.getScaleFromZ(v-1),this.getScaleFromZ(.1)]).on("zoom",this.zoomHandler.bind(this));var m=ht.d(this.mount);this.view=m,m.call(this.d3_zoom);var b=this.getScaleFromZ(this.camera.position.z),f=ht.f.translate(a/2,i/2).scale(b);this.d3_zoom.transform(m,f),this.setState({view:m})}},{key:"addPoints",value:function(){for(var t=this,e=this.props,a=e.embeddings_data,i=e.metadata,s=[],n=0;n<this.props.settings.sprite_number;n++){var r=n*this.sprite_size,o=(n+1)*this.sprite_size;n===this.props.settings.sprite_number-1&&(o=this.props.settings.sprite_number*this.sprite_size),s.push([r,o])}var c,l=s.map((function(t){return a.slice(t[0],t[1])})),h=new lt.k;this.textures=this.tile_locations.map((function(e){var a=h.load(e,function(t){this.setState({tilesLoaded:this.state.tilesLoaded+1})}.bind(t));return a.flipY=!1,a.magFilter=lt.e,a}));for(var d=new lt.c,u=0;u<this.props.settings.sprite_number;u++){for(var p=l[u],g=[],v=0;v<p.length;v++){var m=p[v],b=new lt.m(m[0],m[1],0);g[v]=b}c=new lt.b;var f=g.length,j=new Float32Array(3*f),x=new Float32Array(2*f),O=new Float32Array(3*f),y=new Float32Array(f),w=new Float32Array(f);c.addAttribute("position",new lt.a(j,3)),c.addAttribute("offset",new lt.a(x,2)),c.addAttribute("color",new lt.a(y,1)),c.addAttribute("cluster",new lt.a(O,3)),c.addAttribute("clusterActive",new lt.a(w,1));for(var _=0,S=0,C=f;_<C;_++,S+=3){var k=p[_][0],P=p[_][1];j[S]=k,j[S+1]=P,j[S+2]=0}for(var D=1/this.props.settings.sprite_side,z=0,A=0,F=f;z<F;z++,A+=2){var M=z%this.props.settings.sprite_side*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size,T=Math.floor(z/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size;x[A]=M,x[A+1]=T}if(this.props.settings.clusters.clusterList){var L=this.props.clusterTypeSelected,N=this.props.settings.clusters.clusterColors;console.log("clusterSelected",L);for(var H=0,I=0,R=f;H<R;H++,I+=1)if(y[I]=0,"-"!==L&&this.props.settings.clusters.clusterList.includes(L)){w[I]=1;var E=i[I][L];E>=N.length?(O[3*I]=1,O[3*I+1]=1,O[3*I+2]=1):(O[3*I]=N[E][0],O[3*I+1]=N[E][1],O[3*I+2]=N[E][2])}else w[I]=0}var U={texture:{value:this.textures[u]},repeat:{value:new lt.l(D,D)},size:{value:this.props.settings.sprite_image_size}},V=new lt.j({uniforms:U,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float clusterActive;\n        varying float vClusterActive;\n        attribute float color;\n        varying float vColor;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          vColor = color;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vColor;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          //if ( vClusterActive > 0.9 ){\n            vec4 replace_color = vec4(vCluster,1.0);\n            vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.00392156863);\n            vec4 diff = tex - default_border_color;\n            float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n            tex = mix( tex, replace_color, equality);\n          //}\n\n          // Grey images filter our selection \n          //if ( vColor > 0.9 ){\n          //  tex = vec4(0.3,0.3,0.3,0.1);\n          //}\n          vec4 filterout_color = vec4(0.3,0.3,0.3,0.1);\n          float filterout_equality = float(vColor > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n\n          //tex.r = 1.0;\n          //tex.g = 1.0;\n          //tex.b = 1.0;\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }",transparent:!0}),Z=new lt.g(c,V);Z.userData={sprite_index:u},this.pointsAr.push(Z),d.add(Z)}this.scene.add(d)}},{key:"addBlankHighlightPoints",value:function(){var t=new lt.c;this.scene.add(t);var e=[new lt.m(0,0,0)],a=new lt.b,i=e.length,s=new Float32Array(3*i),n=new Float32Array(2*i);a.addAttribute("position",new lt.a(s,3)),a.addAttribute("offset",new lt.a(n,2));var r=1/this.props.settings.sprite_side,o={texture:{value:this.textures[0]},repeat:{value:new lt.l(r,r)},size:{value:84}},c=new lt.j({uniforms:o,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          //tex.a = tex.r;\n          //tex.r = 1.0;\n          //tex.g = 1.0;\n          //tex.b = 1.0;\n          gl_FragColor = tex;\n        }",transparent:!0}),l=new lt.g(a,c);l.frustumCulled=!1,this.scene.children[1].visible=!1,this.scene.children[1].add(l)}},{key:"highlightPoint",value:function(t,e,a){var i=this.props,s=i.algorithm_choice,n=i.mappings,r=this.scene.children[1].children[0],o=n[s][a],c=[new lt.m(o[0],o[1],0)],l=new Float32Array(2),h=e%this.props.settings.sprite_side*this.props.settings.sprite_image_size/2048,d=Math.floor(e/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/2048;l[0]=h,l[1]=d,r.geometry.attributes.position.copyVector3sArray(c),r.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.offset.array=l,r.geometry.attributes.offset.needsUpdate=!0,r.material.uniforms.texture.value=this.textures[t]}},{key:"removeHighlights",value:function(){var t=this.scene.children[1],e=t.children;t.remove.apply(t,Object(ct.a)(e))}},{key:"checkIntersects",value:function(t){var e=this.props,a=e.width,i=e.height,s=e.previewPane_ctx,n=e.previewPane_image_size;var r=function(t){var e=Object(y.a)(t,2),s=e[0],n=e[1];return new lt.m(s/a*2-1,-n/i*2+1,1)}(t);this.raycaster.setFromCamera(r,this.camera),this.raycaster.params.Points.threshold=.25;var o=this.raycaster.intersectObjects(this.scene.children[0].children);if(o[0]){var c=function(t){return E.sortBy(t,"distanceToRay")}(o),l=c[0],h=l.object.userData.sprite_index,d=l.index,u=h*this.sprite_size+d;if(void 0===this.filterAr||this.filterAr[u]<1){this.props.setHoverIndex(u),this.highlightPoint(h,d,u),this.scene.children[1].visible=!0,s.clearRect(0,0,n,n),s.fillRect(0,0,n,n),s.fillStyle="transparent";try{s.drawImage(this.datasetIMG[h],d%this.props.settings.sprite_side*this.props.settings.sprite_image_size,Math.floor(d/this.props.settings.sprite_side)*this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,0,0,n,n)}catch(p){console.log("previewPane_ctx.drawImage",p)}}}else this.props.setHoverIndex(null),this.scene.children[1].visible=!1,s.fillRect(0,0,n,n),s.fillStyle="transparent"}},{key:"handleMouse",value:function(){var t=this,e=ht.d(this.renderer.domElement);this.raycaster=new lt.h,e.on("mousemove",(function(){var a=ht.b(e.node()),i=Object(y.a)(a,2),s=[i[0],i[1]];t.checkIntersects(s)}))}},{key:"init",value:function(){var t=this.props,e=t.width,a=t.height;this.scene=new lt.i;var i=e/a;this.camera=new lt.f(75,i,.01,1e3),this.renderer=new lt.n,this.renderer.setClearColor(1118481,1),this.renderer.setSize(e,a),this.mount.appendChild(this.renderer.domElement),this.addPoints(),this.addBlankHighlightPoints(),this.setupCamera(),this.animate(),this.handleMouse()}},{key:"animate",value:function(){requestAnimationFrame(this.animate),dt.update(),this.renderer.render(this.scene,this.camera)}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(t){var e=this.props,a=e.width,i=e.height;a===t.width&&i===t.height||this.handleResize(a,i),t.algorithm_choice!==this.props.algorithm_choice&&this.changeEmbeddings(t.algorithm_choice,this.props.algorithm_choice),this.props.scaleMin===t.scaleMin&&this.props.scaleMax===t.scaleMax||this.handleResize(a,i)}},{key:"componentWillUnmount",value:function(){this.mount.removeChild(this.renderer.domElement)}},{key:"render",value:function(){var t=this,e=this.props,a=e.width,i=e.height,s=this.state.tilesLoaded;return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{children:s<1?Object(m.jsx)("div",{className:"loading",children:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(ut.a,{color:"inherit"}),Object(m.jsx)("div",{children:"loading image tiles... "})]})}):""}),Object(m.jsx)("div",{style:{width:a,height:i,overflow:"hidden"},ref:function(e){t.mount=e}})]})}}]),a}(i.Component),gt=s.a.memo(pt),vt=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;Object(l.a)(this,a),(i=e.call(this,t)).calculateProjection=function(t,e,a){var s,n,r;"filter"===e&&(i.setState({currentFilter:t}),s=t,n=i.state.currentSearch),"search"===e&&(i.setState({currentSearch:t}),s=i.state.currentFilter,n=t),a?(r=s.map((function(t,e){return t+n[e]})),i.setState({currentProjection:r})):r=t;try{i.refProjection.current.updateProjection(r)}catch(o){}i.state.filterDataToExportCSV.length>0&&i.setState({filterDataToExportCSV:[]})};var n=i.props.settings.total;return i.state={ww:null,wh:null,hover_index:0,previewPane_height:null,controlPane_height:null,filterPane_height:null,show_about:null,algorithm_choice:0,allFilter:{},currentProjection:new Float32Array(n).fill(0),currentFilter:new Float32Array(n).fill(0),currentSearch:new Float32Array(n).fill(0),scaleMin:14,scaleMax:70,clusterTypeSelected:"-",filterDataToExportCSV:[]},i.previewPane_ctx=null,i.setSize=E.debounce(i.setSize.bind(Object(g.a)(i)),200),i.checkHash=i.checkHash.bind(Object(g.a)(i)),i.setPreviewPaneCanvas=i.setPreviewPaneCanvas.bind(Object(g.a)(i)),i.toggleAbout=i.toggleAbout.bind(Object(g.a)(i)),i.selectAlgorithm=i.selectAlgorithm.bind(Object(g.a)(i)),i.selectDataset=i.selectDataset.bind(Object(g.a)(i)),i.refProjection=s.a.createRef(),i}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.selectAlgorithm(this.props.algorithm_name),this.setSize(),this.checkHash(),window.addEventListener("resize",this.setSize),window.addEventListener("popstate",this.checkHash),this.calcDefaultScale()}},{key:"calcDefaultScale",value:function(){this.props.settings.total<1e4?this.setState({scaleMin:15}):this.setState({scaleMin:5})}},{key:"handleChangeScale",value:function(t,e){this.setState({scaleMin:e})}},{key:"handleChangeZoom",value:function(t,e){this.setState({scaleMax:e})}},{key:"handleChangeCluster",value:function(t){var e=t.target.value;this.setState({clusterTypeSelected:e});try{this.refProjection.current.updateClusterColors(e)}catch(a){console.log("error projector")}}},{key:"selectAlgorithm",value:function(t){var e=this.props.algorithm_options.indexOf(t);e<0&&(e=0),this.setState({algorithm_choice:e}),this.props.addToUrl("projection",this.props.algorithm_options[e])}},{key:"selectDataset",value:function(t){this.props.changeDataset(t)}},{key:"setSize",value:function(){this.setState({ww:window.innerWidth,wh:window.innerHeight});var t=this.previewPane_mount.offsetHeight;this.setState({previewPane_height:t}),this.previewPane_ctx&&(this.previewPane_ctx.imageSmoothingEnabled=!1)}},{key:"setPreviewPaneCanvas",value:function(t){var e=t.getContext("2d");e.imageSmoothingEnabled=!1,this.previewPane_ctx=e,console.log(e)}},{key:"toggleAbout",value:function(t){!0===t?(window.history.pushState(null,"About Collection Space Navigator","#about"),this.setState({show_about:!0})):!1===t&&(window.history.pushState(null,"Collection Space Navigator",window.location.pathname),this.setState({show_about:!1}))}},{key:"setHoverIndex",value:function(t){t&&this.setState({hover_index:t})}},{key:"checkHash",value:function(){window.location.hash&&"#about"===window.location.hash?this.setState({show_about:!0}):this.setState({show_about:!1})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setSize)}},{key:"render",value:function(){for(var t=this,e=this.props,a=e.embeddings_data,i=e.mappings,s=e.algorithm_options,n=e.dataset_options,r=e.metadata,o=e.settings,c=e.barData,l=e.clusterTypeSelected,h=this.state,d=h.ww,u=h.wh,g=h.hover_index,b=h.algorithm_choice,j=h.currentProjection,x=h.allFilter,O=h.filterDataToExportCSV,y=0,w=0;w<o.total;w++)0===j[w]&&y++;var _,S=this.previewPane_ctx,C={position:"absolute",left:0,top:0,background:"#222",flexDirection:"column",zIndex:10},k={position:"relative",height:"100vh",background:"#111",overflow:"hidden"},P=16;if(d<800)P=14,C=Object(p.a)(Object(p.a)({},C),{},{flexDirection:"row",width:"100%",top:"auto",height:"auto",bottom:0}),k={width:d,height:u},_=1.5*P*3;else if(d<1400){var D=200+(d-800)/600*100;P=14+(d-800)/600*2,_=(C=Object(p.a)(Object(p.a)({},C),{},{width:D})).width,k=Object(p.a)(Object(p.a)({},k),{},{width:d,height:u})}else C=Object(p.a)(Object(p.a)({},C),{},{width:300}),k=Object(p.a)(Object(p.a)({},k),{},{width:d,height:u}),_=C.width;var z=1.5*P,A={fontSize:P,lineHeight:1.5};return null!==d?Object(m.jsxs)("div",{style:A,children:[Object(m.jsx)("div",{style:{position:"absolute",right:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#222",zIndex:11},ref:function(e){t.controlMenu_mount=e},children:Object(m.jsx)("div",{children:Object(m.jsx)(ot.c,{children:Object(m.jsxs)(ot.a,{iconShape:"square",children:[Object(m.jsx)(ot.d,{title:"Data & Mapping",defaultOpen:"True",children:Object(m.jsx)(ot.b,{children:Object(m.jsx)(rt,{grem:z,algorithm_options:s,algorithm_choice:b,selectAlgorithm:this.selectAlgorithm,dataset_options:n,selectDataset:this.selectDataset,selectedDataset:this.props.selectedDataset,datasetInfo:o.datasetInfo})})}),Object(m.jsx)(ot.d,{title:"Range Sliders",defaultOpen:"True",children:Object(m.jsx)(ot.b,{children:Object(m.jsx)(H,{grem:z,toggleAbout:this.toggleAbout,metadata:r,hover_index:g,settings:o,barData:c,calculateProjection:this.calculateProjection,currentProjection:j,allFilter:x})})}),Object(m.jsx)(ot.d,{title:"Advanced Search & Filter",style:{overflow:"visible"},children:Object(m.jsx)(ot.b,{children:Object(m.jsx)(J,{grem:z,calculateProjection:this.calculateProjection,hover_index:g,settings:o,metadata:r,currentProjection:j,allFilter:x})})}),Object(m.jsx)(ot.d,{title:"Export",children:Object(m.jsx)(v.CSVLink,{data:O,filename:"CSN_filtered_metadata.csv",className:"btn-csv-download",target:"_blank",onClick:function(){for(var e=[],a=0;a<r.length;a++)if(0===j[a]){var i=r[a];e.push(i)}t.setState({filterDataToExportCSV:e}),console.log(O)},children:"Download CSV filter metadata"})})]})})})}),Object(m.jsx)("div",{style:C,ref:function(e){t.previewPane_mount=e},children:Object(m.jsx)(ot.c,{width:_,children:Object(m.jsxs)(ot.a,{iconShape:"square",children:[Object(m.jsx)(ot.d,{title:"Preview",defaultOpen:"True",children:Object(m.jsx)(f,{previewPane_image_size:_,setPreviewPaneCanvas:this.setPreviewPaneCanvas,prevURL:o.url_prefix+r[g].URL})}),Object(m.jsx)(ot.d,{title:"Info",defaultOpen:"True",children:Object(m.jsx)(ot.b,{children:Object(m.jsx)(tt,{hover_index:g,metadata:r,infos:o.info})})}),Object(m.jsx)(ot.d,{title:"View Settings",children:Object(m.jsx)(ot.b,{children:Object(m.jsx)(st,{clusters:o.clusters,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,handleChangeScale:this.handleChangeScale.bind(this),handleChangeZoom:this.handleChangeZoom.bind(this),handleChangeCluster:this.handleChangeCluster.bind(this),total:o.total})})})]})})}),Object(m.jsxs)("div",{style:k,children:[Object(m.jsx)(gt,{ref:this.refProjection,width:k.width,height:k.height,embeddings_data:a,mappings:i,metadata:r,previewPane_ctx:S,previewPane_image_size:_,setHoverIndex:this.setHoverIndex.bind(this),algorithm_choice:b,datasetDir:this.props.datasetDir,clusterTypeSelected:l,settings:o,initPath:this.props.initPath,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax}),Object(m.jsxs)("div",{style:{fontSize:"13px",bottom:"2px",left:"8px",position:"absolute"},children:["showing ",y," / ",o.total]}),Object(m.jsx)("div",{style:{fontSize:"13px",bottom:"2px",right:"8px",position:"absolute"},children:Object(m.jsx)("a",{href:"https://github.com/Collection-Space-Navigator/CSN",target:"blank",children:"Collection Space Navigator"})})]})]}):Object(m.jsxs)("div",{className:"loading",children:[Object(m.jsx)(ut.a,{color:"inherit"}),Object(m.jsx)("div",{children:"loading layout..."})]})}}]),a}(i.Component),mt=a(64),bt=a.n(mt);var ft,jt=function(t){Object(d.a)(a,t);var e=Object(u.a)(a);function a(t){var i;return Object(l.a)(this,a),(i=e.call(this,t)).state={algorithm_options:null,dataset_options:null,dataset_dirs:null,embeddings_data:null,mappings:null,metadata:null,defaultDataset:null,algorithm_name:0},i}return Object(h.a)(a,[{key:"scaleEmbeddings",value:function(t){var e=t.map((function(t){return Math.abs(t[0])})),a=t.map((function(t){return Math.abs(t[1])})),i=E.max(e),s=E.max(a),n=Math.max(i,s),r=ht.c().domain([-n,n]).range([-20,20]);return t.map((function(t){return[r(t[0]),r(t[1])]}))}},{key:"componentDidMount",value:function(){var t=window.location.search,e=new URLSearchParams(t);this.setState({selectedDataset:e.get("dataset")}),void 0!==e.get("projection")&&this.setState({algorithm_name:e.get("projection")}),this.loadInit("datasets/datasets_config.json")}},{key:"loadConfig",value:function(t){this.loadSettings("datasets/".concat(t,"/config.json")),this.loadBarData("datasets/".concat(t,"/barData.json")),this.loadMetadata("datasets/".concat(t,"/metadata.json"))}},{key:"prepareMappings",value:function(t){var e=[];for(var a in this.state.settings.embeddings)console.log(this.state.settings.embeddings[a].name),e[a]=this.state.settings.embeddings[a].name;this.setState({algorithm_options:e})}},{key:"loadDataset",value:function(t){var e=this,a=[],i=this.state.settings.embeddings,s=function(t){fetch("".concat("/CSN","/datasets/").concat(e.state.datasetDir,"/").concat(i[t].file)).then((function(t){return t.json()})).then((function(e){var i=e;a[t]=i})).then((function(){e.setState({mappings:a,embeddings_data:a[0]})}))};for(var n in i)s(n)}},{key:"addToUrl",value:function(t,e){var a=window.location.search,i=new URLSearchParams(a);i.set(t,e),this.props.navigate("?"+i.toString())}},{key:"prepareDatasets",value:function(t){var e=[],a=[];for(var i in this.state.settings.embeddings)console.log(this.state.settings.embeddings[i].name),e[i]=this.state.settings.embeddings[i].name,a[i]=this.state.settings.embeddings[i].directory;this.setState({dataset_options:e,dataset_dirs:a})}},{key:"changeDataset",value:function(t){this.addToUrl("dataset",t);var e=this.state.dataset_options.indexOf(t),a=this.state.dataset_dirs[e];this.setState({selectedDataset:t,datasetDir:a,algorithm_options:null,embeddings_data:null,mappings:null,metadata:null}),this.loadConfig(a)}},{key:"loadInit",value:function(t){var e=this;fetch("".concat("/CSN","/")+t).then((function(t){return t.json()})).then((function(t){var a=[],i=[];for(var s in t.data)console.log(t.data[s].directory),a[s]=t.data[s].name,i[s]=t.data[s].directory;if(e.setState({dataset_options:a,dataset_dirs:i}),null===e.state.selectedDataset)e.setState({selectedDataset:t.data[t.default].name,datasetDir:t.data[t.default].directory}),e.addToUrl("dataset",t.data[t.default].name);else{var n=!1;for(var r in t.data)t.data[r].name===e.state.selectedDataset&&(e.setState({datasetDir:t.data[r].directory}),n=!0);n||e.setState({selectedDataset:t.data[t.default].name,datasetDir:t.data[t.default].directory})}})).then((function(){return e.loadConfig(e.state.datasetDir)}))}},{key:"loadSettings",value:function(t){var e=this;fetch("".concat("/CSN","/")+t).then((function(t){return t.json()})).then((function(t){try{var a=t.clusters.clusterColors.map((function(t){return[bt()(t).rgb().array()[0]/255,bt()(t).rgb().array()[1]/255,bt()(t).rgb().array()[2]/255]}));t.clusters.clusterColors=a}catch(i){}e.setState({settings:t})})).then((function(){return e.prepareMappings(0)})).then((function(){return e.loadDataset(0)}))}},{key:"loadMetadata",value:function(t){var e=this;fetch("".concat("/CSN","/")+t).then((function(t){return t.json()})).then((function(t){return e.setState({metadata:t})}))}},{key:"loadBarData",value:function(t){var e=this;fetch("".concat("/CSN","/")+t).then((function(t){return t.json()})).then((function(t){return e.setState({barData:t})}))}},{key:"render",value:function(){return this.state.embeddings_data&&this.state.metadata?Object(m.jsx)(vt,Object(p.a)(Object(p.a)({},this.state),{},{addToUrl:this.addToUrl.bind(this),algorithm_name:this.state.algorithm_name,algorithm_options:this.state.algorithm_options,dataset_options:this.state.dataset_options,dataset_dirs:this.state.dataset_dirs,changeDataset:this.changeDataset.bind(this),selectedDataset:this.state.selectedDataset,datasetDir:this.state.datasetDir})):Object(m.jsxs)("div",{className:"loading",children:[Object(m.jsx)(ut.a,{color:"inherit"}),Object(m.jsx)("div",{children:"loading datasets... "})]})}}]),a}(i.Component),xt=(ft=jt,function(t){return Object(m.jsx)(ft,Object(p.a)(Object(p.a)({},t),{},{params:Object(c.n)(),navigate:Object(c.l)()}))});function Ot(){return Object(m.jsx)(o.a,{children:Object(m.jsxs)(c.c,{children:[Object(m.jsx)(c.a,{exact:!0,path:"/",element:Object(m.jsx)(xt,{})}),Object(m.jsx)(c.a,{exact:!0,path:"/CSN",element:Object(m.jsx)(xt,{})})]})})}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(m.jsx)(Ot,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[135,1,2]]]);
//# sourceMappingURL=main.73eebced.chunk.js.map