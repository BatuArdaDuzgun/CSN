(this.webpackJsonpCSN=this.webpackJsonpCSN||[]).push([[0],{115:function(e,t,a){},116:function(e,t,a){},127:function(e,t,a){},135:function(e,t,a){},144:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),r=a(23),s=a.n(r),o=(a(115),a(76)),c=a(8),l=(a(116),a(6)),d=a(5),h=a(9),u=a(10),p=a(32),m=a(18),v=a(1),g=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).state={dimensions:{},imgURL:null,previewImage:!1,timeoutId:null},i}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.props.setPreviewPaneCanvas(this.side_canvas)}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.hover_index!==e.hover_index){this.setState({previewImage:!1}),clearTimeout(this.state.timeoutId);var a=setTimeout((function(){t.setState({previewImage:!0})}),100);this.setState({timeoutId:a})}}},{key:"render",value:function(){var e=this,t=this.props.previewPane_image_size;return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{style:{position:"absolute",width:t,height:t,textAlign:"center"},children:[Object(v.jsx)("span",{style:{display:"inline-block",height:"100%",verticalAlign:"middle"}}),!0===this.state.previewImage?this.props.setPreviewImage():null]}),Object(v.jsx)("canvas",{ref:function(t){e.side_canvas=t},width:t,height:t})]})}}]),a}(i.Component),f=n.a.memo(g),j=a(178),b=a(182),x=a(186),O=a(55),y=a(16),_=a(177),w=a(11),S=12;var C=Object(w.a)((function(e){return{rail:{backgroundColor:e.palette.grey[400],width:"100%",height:2,position:"absolute",pointerEvents:"none"},railHotspot:{width:"100%",height:24,top:-12,position:"absolute",cursor:"pointer"}}}))((function(e){var t=e.classes,a=e.getRailProps;return Object(v.jsxs)(i.Fragment,{children:[Object(v.jsx)("div",Object(p.a)({className:t.railHotspot},a())),Object(v.jsx)("div",{className:t.rail})]})}));var k=Object(w.a)((function(e){return{root:{backgroundColor:e.palette.secondary.main,marginLeft:-6,marginTop:-6,width:S,height:S,border:0,borderRadius:"50%",whiteSpace:"nowrap",position:"absolute",zIndex:2,cursor:"pointer"}}}))((function(e){var t=Object(y.a)(e.domain,2),a=t[0],i=t[1],n=e.handle,r=n.id,s=n.value,o=n.percent,c=e.classes,l=e.getHandleProps;return Object(v.jsx)("div",Object(p.a)({role:"slider","aria-valuemin":a,"aria-valuemax":i,"aria-valuenow":s,className:c.root,style:{left:"".concat(o,"%")}},l(r)))}));var P=Object(w.a)((function(e){return{track:{backgroundColor:e.palette.secondary.main,height:2,position:"absolute",zIndex:1,pointerEvents:"none"},trackHotspot:{height:S,top:-6,position:"absolute",cursor:"pointer"}}}))((function(e){var t=e.classes,a=e.source,n=e.target,r=e.getTrackProps,s="".concat(a.percent,"%"),o="".concat(n.percent-a.percent,"%");return Object(v.jsxs)(i.Fragment,{children:[Object(v.jsx)("div",{className:t.track,style:{left:s,width:o}}),Object(v.jsx)("div",Object(p.a)({className:t.trackHotspot,style:{left:s,width:o}},r()))]})}));function D(e){var t=e.classes,a=e.tick,i=e.count,n=e.format;return Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:t.tick,style:{left:"".concat(a.percent,"%")}}),Object(v.jsx)(_.a,{className:t.label,variant:"caption",style:{marginLeft:"".concat(-100/i/2,"%"),width:"".concat(100/i,"%"),left:"".concat(a.percent,"%")},children:n(a.value)})]})}D.defaultProps={format:function(e){return e}};Object(w.a)((function(e){return{tick:{position:"absolute",marginTop:14,width:1,height:5,backgroundColor:e.palette.grey[400]},label:{position:"absolute",marginTop:22,textAlign:"center"}}}))(D);var A=a(78),z=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).state={isHovering:!1,barSelected:null},i.onLeave=i.onLeave.bind(Object(m.a)(i)),i}return Object(d.a)(a,[{key:"calculateHistogram",value:function(e,t){for(var a=[],i=0;i<this.props.settings.total;i++)0===this.props.currentProjection[i]&&a.push(this.props.metadata[i][this.props.sliderID]);var n={};this.bucketsFinder={};var r,s;r=e[0]<0?(Math.abs(e[0])+Math.abs(e[1]))/50:Math.abs((Math.abs(e[0])-Math.abs(e[1]))/50);for(var o=0;o<50;o++)n[o]=0;for(var c=0;c<a.length;c++)n[s=a[c]===e[1]?49:(a[c]-e[0])/r|0]+=1,this.bucketsFinder[parseFloat(a[c]).toFixed(1)]=s;var l=Object.values(n);if(!0===t){var d=Math.max.apply(Math,l)/50;for(c=0;c<l.length;c++)l[c]=Math.round(l[c]/d)}for(var h=[],u=0;u<l.length;u++)h.push(l[u]||0);return h}},{key:"hoverEffect",value:function(e){if(this.setState({isHovering:!0}),e[0]){var t=e[0].index,a=new Float32Array(this.props.settings.total).fill(1),i=this.props.currentProjection;this.props.barData.selections[t].forEach((function(e){a[e]=i[e]})),this.props.calculateProjection(a,null,!1),this.setState({barSelected:t})}}},{key:"onLeave",value:function(){this.setState({isHovering:!1}),this.props.calculateProjection(this.props.currentProjection,null,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.barData,i=t.domain,n=t.color,r=t.selected;A.b.animation=!1;var s=Array(50).fill(0);this.barDataSoll=a.histogram,this.barDataIst=this.calculateHistogram(i,!1);var o={labels:this.barDataSoll.map((function(e,t){return t})),datasets:[{label:"barDataIst",type:"bar",barThickness:5,normalized:!0,order:2,backgroundColor:this.state.isHovering?"rgb(64, 64, 64)":s.map((function(t,a){return a===e.bucketsFinder[parseFloat(r).toFixed(1)]?"#f50057":n})),hoverBackgroundColor:n,data:this.barDataIst},{label:"barDataSoll",type:"bar",barThickness:5,normalized:!0,order:3,backgroundColor:s.map((function(t,a){return a===e.bucketsFinder[parseFloat(r).toFixed(1)]?"#542032":"rgb(64, 64, 64)"})),hoverBackgroundColor:"rgb(64, 64, 64)",data:this.barDataSoll}]},c={responsive:!0,interaction:{mode:"index",intersect:!1},events:["mouseleave","mousemove","mouseout","click"],hoverBackgroundColor:n,onClick:function(){e.setState({isHovering:!e.state.isHovering}),e.props.calculateProjection(e.props.currentProjection,null,!1)},onHover:function(t,a){"mousemove"===t.type&&e.state.isHovering&&e.state.barSelected!==a[0].index?(e.setState({bgColor:"rgb(64, 64, 64)"}),e.hoverEffect(a),"ew-resize"!==t.native.target.style.cursor&&(t.native.target.style.cursor="ew-resize")):e.state.isHovering||"pointer"===t.native.target.style.cursor||(t.native.target.style.cursor="pointer")},plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1,stacked:!0},yAxes:{beginAtZero:!0,display:!1}}};return Object(v.jsx)(A.a,{data:o,height:62,options:c,onMouseLeave:this.onLeave})}}]),a}(n.a.Component),F=n.a.memo(z),T=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={domain:e.props.range,update:e.props.range,values:e.props.range,inputValues:e.props.range,typeNumber:e.props.typeNumber,step:e.props.step,color:e.props.color,hover_index:e.props.hover_index,isToggleOn:!1},e.handleClick=function(t){e.setState((function(e){return{isToggleOn:!e.isToggleOn}})),t.stopPropagation()},e.changeSlider=function(t){e.props.onChangeSlider(e.props.id,t)},e}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.domain,i=t.values,n=t.update,r=t.inputValues,s=t.color,o=t.typeNumber;return Object(v.jsx)(j.a,{container:!0,children:Object(v.jsx)(j.a,{item:!0,xs:12,children:Object(v.jsxs)("div",{style:{height:"90px",width:"270px",marginTop:"22px"},children:[Object(v.jsx)(F,{update:n,domain:a,color:s,barData:this.props.barData,calculateProjection:this.props.calculateProjection,settings:this.props.settings,currentProjection:this.props.currentProjection,sliderID:this.props.sliderID,metadata:this.props.metadata,selected:this.props.metadata[this.props.hover_index][this.props.sliderID]}),Object(v.jsxs)(O.c,{mode:3,step:"int"===o?1:.01,domain:a,color:s,rootStyle:{position:"relative",width:"100%"},onUpdate:function(t){e.setState({update:t,inputValues:t})},onChange:function(t){e.setState({values:t}),e.changeSlider(n)},values:i,children:[Object(v.jsx)(O.b,{children:function(e){var t=e.getRailProps;return Object(v.jsx)(C,{getRailProps:t})}}),Object(v.jsx)(O.a,{children:function(e){var t=e.handles,i=e.getHandleProps;return Object(v.jsx)("div",{className:"slider-handles",children:t.map((function(e){return Object(v.jsx)(k,{handle:e,domain:a,getHandleProps:i},e.id)}))})}}),Object(v.jsx)(O.d,{left:!1,right:!1,children:function(e){var t=e.tracks,a=e.getTrackProps;return Object(v.jsx)("div",{className:"slider-tracks",children:t.map((function(e){var t=e.id,i=e.source,n=e.target;return Object(v.jsx)(P,{source:i,target:n,getTrackProps:a},t)}))})}})]}),Object(v.jsxs)(j.a,{container:!0,alignItems:"center",justifyContent:"space-around",children:[Object(v.jsx)(j.a,{item:!0,xs:3,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto"},children:Object(v.jsx)(b.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",width:"8px",value:r[0],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:function(t){var i=t.target.value,n=[i,r[1]];e.setState({inputValues:n}),i&&i>=a[0]&&e.setState({values:n})}})}),Object(v.jsx)(j.a,{item:!0,xs:4,style:{textAlign:"center",marginTop:"-6px"},children:Object(v.jsx)(x.a,{title:Object(v.jsx)("h3",{children:this.props.info}),children:Object(v.jsx)("h3",{style:{cursor:"help"},children:this.props.title})})}),Object(v.jsx)(j.a,{item:!0,xs:3,style:{textAlign:"right",border:"solid 1px white",height:"20px",marginLeft:"auto",marginRight:"auto"},children:Object(v.jsx)(b.a,{fullWidth:!0,variant:"outlined",label:"",size:"small",value:r[1],margin:"none",inputProps:{style:{color:"white",padding:0,marginLeft:2}},onChange:function(t){var n=t.target.value,s=[r[0],n];e.setState({inputValues:s}),n&&n<=a[1]&&n>=i[0]&&e.setState({values:s})}})})]})]})})})}}]),a}(n.a.Component),M=n.a.memo(T),I=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;for(var r in Object(l.a)(this,a),(i=t.call(this,e)).changeSlider=i.changeSlider.bind(Object(m.a)(i)),i.slidersAr=[],i.props.settings.sliders)i.slidersAr.push(i.props.settings.sliders[r].id);i.refSliders={},i.filterData={},i.filtered={};for(var s=0;s<i.slidersAr.length;s+=1){i.refSliders[i.slidersAr[s]]=n.a.createRef();var o=[];for(var c in i.props.metadata)o.push(i.props.metadata[c][i.slidersAr[s]]);i.filterData[i.slidersAr[s]]=o}return i.state={datafilter:i.filterData},i}return Object(d.a)(a,[{key:"changeSlider",value:function(e,t){var a=this.props.metadata;this.filtered[e]=new Float32Array(this.props.settings.total).fill(0);var i=new Float32Array(this.props.settings.total);for(var n in a)(t[0]>a[n][e]||t[1]<a[n][e])&&(this.filtered[e][n]=1);var r=Object.values(this.filtered),s=i.map((function(e,t){return r.reduce((function(e,a){return e+a[t]}),0)}));this.props.calculateProjection(s,"filter",!0)}},{key:"render",value:function(){var e=this,t=this.props,a=t.hover_index,i=t.settings,n=t.barData,r=i.sliders.map((function(t){return Object(v.jsx)(j.a,{item:!0,children:Object(v.jsx)(M,{ref:e.refSliders[t.id],datafilter:e.state.datafilter[t.id],title:t.title,id:t.id,info:t.info,typeNumber:t.typeNumber,color:t.color,onChangeSlider:e.changeSlider,hover_index:a,barData:n[t.id],calculateProjection:e.props.calculateProjection,currentProjection:e.props.currentProjection,settings:i,sliderID:t.id,metadata:e.props.metadata,range:[t.min,t.max]})})}));return Object(v.jsx)(j.a,{container:!0,style:{marginLeft:"6px"},children:Object(v.jsx)(j.a,{item:!0,children:r})})}}]),a}(i.Component),N=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).sliderReset=i.sliderReset.bind(Object(m.a)(i)),i}return Object(d.a)(a,[{key:"sliderReset",value:function(){console.log("reset range sliders")}},{key:"render",value:function(){var e=this.props,t=e.metadata,a=e.hover_index;return Object(v.jsx)(I,{metadata:t,settings:this.props.settings,hover_index:a,barData:this.props.barData,filterImageAr:this.props.filterImageAr,calculateProjection:this.props.calculateProjection,currentProjection:this.props.currentProjection})}}]),a}(i.Component),R=n.a.memo(N),E=a(31),H=a(180),L=a(146),U=a(77),G=a.n(U),W=(a(127),function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"filter",value:function(e,t,a,i){var n=this.tryToGetFieldCategory(t);switch(a){case"==":return e[n]===i;case"!=":return e[n]!==i;case"contains":return e[n].toLowerCase().indexOf(i.toLowerCase())>=0;case"!contains":return e[n].toLowerCase().indexOf(i.toLowerCase())<0;default:return!1}}}]),a}(U.SimpleResultProcessing)),V=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).exportMetadata=function(){for(var e=[],t=0;t<i.props.metadata.length;t++)if(0===i.props.currentProjection[t]){var a=i.props.metadata[t];e.push(a)}i.setState({filterDataToExportCSV:e},(function(){document.getElementsByClassName("hidden")[0].click()}))},i.state={parseOK:!0,query2:{}},i.applyFilter=i.applyFilter.bind(Object(m.a)(i)),i.resetFilter=i.resetFilter.bind(Object(m.a)(i)),i.options=i.props.settings.search,i}return Object(d.a)(a,[{key:"applyFilter",value:function(){var e=new W(this.options).process(this.props.metadata,this.state.query2),t=new Float32Array(this.props.settings.total).fill(1);e.forEach((function(e){t[e.index]=0})),this.props.calculateProjection(t,"search",!0)}},{key:"resetFilter",value:function(){this.setState({query:null,query2:""});var e=new Float32Array(this.props.settings.total).fill(0);this.props.calculateProjection(e,"search",!0)}},{key:"customRenderCompletionItem",value:function(e,t,a){var i="hint-value cm-".concat(t.type);return Object(v.jsxs)("div",{className:i,children:[Object(v.jsx)("span",{style:{fontWeight:"bold"},children:t.value}),Object(v.jsxs)("span",{style:{color:"gray",fontSize:10},children:[" [",t.type,"] "]})]})}},{key:"onParseOk",value:function(e){this.setState({parseOK:!1}),this.setState({query2:e})}},{key:"onParseError",value:function(e){this.setState({parseOK:!0})}},{key:"render",value:function(){return Object(v.jsxs)("div",{className:"main-container",children:[Object(v.jsx)(G.a,{customRenderCompletionItem:this.customRenderCompletionItem.bind(this),query:this.state.query,data:this.props.metadata,options:this.options,onParseOk:this.onParseOk.bind(this),onParseError:this.onParseError.bind(this),editorConfig:{lineWrapping:!0}}),Object(v.jsxs)(H.a,{variant:"contained",children:[Object(v.jsx)(L.a,{onClick:this.applyFilter,children:"apply"}),Object(v.jsx)(L.a,{onClick:this.resetFilter,children:"reset"})]})]})}}]),a}(i.Component),Z=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props,t=e.metadata,a=e.settings;return Object(v.jsx)(j.a,{container:!0,spacing:2,children:Object(v.jsx)(V,{calculateProjection:this.props.calculateProjection,settings:a,metadata:t,currentProjection:this.props.currentProjection,allFilter:this.props.allFilter})})}}]),a}(i.Component),q=n.a.memo(Z),B=a(68),K=a.n(B),J=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).state={},i}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props,t=e.metadata,a=e.hover_index,n=e.infos,r={color:"CornflowerBlue"},s=n.map((function(e){return Object(v.jsxs)(i.Fragment,{children:[Object(v.jsxs)(j.a,{item:!0,xs:4,children:[e,":"]},K()()),Object(v.jsx)(j.a,{item:!0,xs:8,children:"string"===typeof t[a][e]&&t[a][e].length>4&&"http"===t[a][e].substring(0,4)?Object(v.jsxs)("a",{href:t[a][e],target:"_blank",rel:"noreferrer",style:r,children:[t[a][e].substring(8,30),"..."]}):t[a][e]},K()())]})}));return Object(v.jsx)(j.a,{container:!0,justifyContent:"space-between",spacing:1,wrap:"wrap",children:s},K()())}}]),a}(i.Component),Y=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).state={dimensions:{}},i}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props,t=e.hover_index,a=e.infos,i=e.metadata;return Object(v.jsx)(J,{metadata:i,hover_index:t,infos:a})}}]),a}(i.Component),$=n.a.memo(Y),Q=a(184),X=a(187),ee=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).handleChange=function(){i.setState((function(e){return{checked:!e.checked}})),i.props.handleChangeGrey(i.state.checked?1:0)},i.state={dimensions:{},checked:i.props.filterGrey},i}return Object(d.a)(a,[{key:"render",value:function(){var e=this.props.clusters;return Object(v.jsxs)(j.a,{container:!0,spacing:1,children:[Object(v.jsx)(j.a,{item:!0,xs:4,children:"clusters:"}),Object(v.jsx)(j.a,{item:!0,xs:8,children:Object(v.jsxs)("select",{onChange:this.props.handleChangeCluster,children:[Object(v.jsx)("option",{value:"disabled",children:"-"},"0"),e.clusterList.map((function(e,t){return Object(v.jsx)("option",{value:e,children:e.toLowerCase()},e)}))]})}),Object(v.jsx)(j.a,{item:!0,xs:4,children:"size (out):"}),Object(v.jsx)(j.a,{item:!0,xs:8,children:Object(v.jsx)(Q.a,{height:10,children:Object(v.jsx)(X.a,{size:"small",defaultValue:this.props.scaleMin,min:3,max:60,onChange:this.props.handleChangeScale})})}),Object(v.jsx)(j.a,{item:!0,xs:4,children:"size (in):"}),Object(v.jsx)(j.a,{item:!0,xs:8,children:Object(v.jsx)(Q.a,{height:10,children:Object(v.jsx)(X.a,{size:"small",defaultValue:this.props.scaleMax,min:3,max:120,onChange:this.props.handleChangeZoom})})}),Object(v.jsx)(j.a,{item:!0,xs:11,children:"show filtered-out items (slower):"}),Object(v.jsx)(j.a,{item:!0,xs:1,children:Object(v.jsx)("input",{type:"checkbox",checked:this.state.checked,onChange:this.handleChange})})]})}}]),a}(i.Component),te=n.a.memo(ee),ae=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).handleSelectAlgorithm=i.handleSelectAlgorithm.bind(Object(m.a)(i)),i.handleSelectDataset=i.handleSelectDataset.bind(Object(m.a)(i)),i}return Object(d.a)(a,[{key:"handleSelectAlgorithm",value:function(e){var t=e.target.value;this.props.selectAlgorithm(t)}},{key:"handleSelectDataset",value:function(e){var t=e.target.value;this.props.selectDataset(t)}},{key:"render",value:function(){var e=this.props,t=e.algorithm_options,a=e.algorithm_choice,i=e.dataset_options,n=e.selectedDataset,r=e.datasetInfo;return Object(v.jsxs)(j.a,{container:!0,spacing:1,children:[Object(v.jsx)(j.a,{item:!0,xs:4,children:"Dataset:"}),Object(v.jsx)(j.a,{item:!0,xs:8,children:Object(v.jsx)("select",{className:"full-width",onChange:this.handleSelectDataset,value:n,children:i.map((function(e,t){return Object(v.jsx)("option",{value:e,children:e},e)}))})}),Object(v.jsx)(j.a,{item:!0,xs:4,children:"Projection:"}),Object(v.jsx)(j.a,{item:!0,xs:8,children:Object(v.jsx)("select",{className:"full-width",onChange:this.handleSelectAlgorithm,value:t[a],children:t.map((function(e,t){return Object(v.jsx)("option",{value:e,children:e},e)}))})}),Object(v.jsx)(j.a,{item:!0,xs:12,children:Object(v.jsx)("p",{className:"info",children:r})})]})}}]),a}(i.Component),ie=n.a.memo(ae),ne=a(17),re=a(28),se=a(88),oe=a(89),ce=a.n(oe),le=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).makePNG=Object(re.a)(Object(ne.a)().mark((function e(){return Object(ne.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("download projection area as png"),ce()(document.getElementById("threeCanvas"));case 2:case"end":return e.stop()}}),e)}))),i.state={filterDataToExportCSV:[]},i}return Object(d.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.metadata,i=t.currentProjection;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("div",{style:{marginBottom:"12px"},children:Object(v.jsx)(se.CSVLink,{data:this.state.filterDataToExportCSV,filename:"CSN_filtered_metadata.csv",target:"_blank",onClick:function(){for(var t=[],n=0;n<a.length;n++)if(0===i[n]){var r=a[n];t.push(r)}e.setState({filterDataToExportCSV:t})},children:Object(v.jsx)(L.a,{variant:"contained",fullWidth:!0,children:"Download metadata CSV"})})}),Object(v.jsx)("div",{children:Object(v.jsx)(L.a,{variant:"contained",fullWidth:!0,onClick:this.makePNG,children:"Download projection PNG"})})]})}}]),a}(i.Component),de=n.a.memo(le),he=a(26),ue=(a(135),a(15)),pe=a(22),me=a(35),ve=a(69),ge=a(181),fe=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).handleResize=function(e,t){i.camera.aspect=e/t,i.camera.updateProjectionMatrix(),i.renderer.setSize(e,t);var a=i.getScaleFromZ(i.camera.position.z),n=-i.camera.position.x*a+i.props.width/2,r=i.camera.position.y*a+i.props.height/2,s=me.f.translate(n,r).scale(a),o=me.d(i.mount);i.d3_zoom.transform(o,s)},i.updateProjection=function(e){i.filterAr=e;for(var t=[],a=[],n=0;n<i.props.settings.sprite_number;n++){var r=n*i.sprite_size,s=(n+1)*i.sprite_size;n===i.props.settings.sprite_number-1&&(s=i.props.settings.sprite_number*i.sprite_size),t.push([r,s]),a.push(e.slice(r,s))}for(var o=0;o<i.props.settings.sprite_number;o++){var c=i.scene.children[0].children[o];c.geometry.attributes.filteredActive=new pe.a(a[o],1),c.geometry.attributes.filteredActive.needsUpdate=!0}},i.updatePass2Shader=function(e){for(var t=0;t<i.props.settings.sprite_number;t++){var a=i.scene.children[0].children[t];1===e&&(a.material.uniforms.greyTransparency.value=.1,a.material.uniforms.greyTransparency.needsUpdate=!0,a.material.uniforms.imageTransparency.value=1,a.material.uniforms.imageTransparency.needsUpdate=!0),2===e&&(a.material.uniforms.greyTransparency.value=0,a.material.uniforms.greyTransparency.needsUpdate=!0,a.material.uniforms.imageTransparency.value=0,a.material.uniforms.imageTransparency.needsUpdate=!0)}},i.updateClusterColors=function(e){console.log("updateClusterColors",e);var t=i.props.metadata.length;console.log("clusterSelected:",e,"numVertices Update --\x3e",t," metadata.length:",i.props.metadata.length);var a=new Float32Array(3*t),n=i.props.settings.clusters.clusterColors;console.log(t,"-"!==e,i.props.settings.total,n);var r=[],s=[];if("disabled"!==e){for(var o=[],c=0,l=0,d=t;c<d;c++,l+=1){var h=i.props.metadata[l][e];-1===o.indexOf(h)&&o.push(h);var u=o.indexOf(h);u>=n.length?(a[3*l]=Math.random(),a[3*l+1]=Math.random(),a[3*l+2]=Math.random()):(a[3*l]=n[u][0],a[3*l+1]=n[u][1],a[3*l+2]=n[u][2])}for(var p=0;p<i.props.settings.sprite_number;p++){var m=p*i.sprite_size,v=(p+1)*i.sprite_size;p===i.props.settings.sprite_number-1&&(v=i.props.settings.sprite_number*i.sprite_size),r.push([m,v]),s.push(a.slice(3*m,3*v))}}for(var g=0;g<i.props.settings.sprite_number;g++){var f=i.scene.children[0].children[g];"disabled"!==e?(f.geometry.attributes.cluster=new pe.a(s[g],3),f.geometry.attributes.cluster.needsUpdate=!0,f.material.uniforms.clusterActive.value=1,f.material.uniforms.clusterActive.needsUpdate=!0):(f.material.uniforms.clusterActive.value=0,f.material.uniforms.clusterActive.needsUpdate=!0)}},i.loadTiles(),i.state={tilesLoaded:0,view:null},i.init=i.init.bind(Object(m.a)(i)),i.pointsAr=[],i.addPoints=i.addPoints.bind(Object(m.a)(i)),i.handleResize=i.handleResize.bind(Object(m.a)(i)),i.setupCamera=i.setupCamera.bind(Object(m.a)(i)),i.animate=i.animate.bind(Object(m.a)(i)),i.getScaleFromZ=i.getScaleFromZ.bind(Object(m.a)(i)),i.getZFromScale=i.getZFromScale.bind(Object(m.a)(i)),i.changeEmbeddings=i.changeEmbeddings.bind(Object(m.a)(i)),i}return Object(d.a)(a,[{key:"loadTiles",value:function(){var e=this;this.sprite_size=this.props.settings.sprite_side*this.props.settings.sprite_side,this.tile_locations=Object(ue.a)(Array(this.props.settings.sprite_number)).map((function(t,a){return"".concat("/CSN","/datasets/").concat(e.props.settings.sprite_dir,"/tile_").concat(a,".png")})),this.datasetIMG=this.tile_locations.map((function(e){var t=document.createElement("img");return t.src=e,t}))}},{key:"changeEmbeddings",value:function(e){for(var t=this,a=[],i=0;i<this.props.settings.sprite_number;i++){var n=i*this.sprite_size,r=(i+1)*this.sprite_size;i===this.props.settings.sprite_number-1&&(r=this.props.settings.sprite_number*this.sprite_size),a.push([n,r])}for(var s=a.map((function(a){return t.props.mappings[e].slice(a[0],a[1])})),o=function(){for(var e=s[c],a=t.scene.children[0].children[c],i=e.length,n=a.geometry.attributes.position.array,r=new Float32Array(3*i),o=0,l=0,d=i;o<d;o++,l+=3){var h=e[o][0],u=e[o][1];r[l]=h,r[l+1]=u,r[l+2]=0}var p=new ve.b(n).to(r,1e3).easing(ve.a.Linear.None);p.onUpdate((function(){a.geometry.attributes.position=new pe.a(n,3),a.geometry.attributes.position.needsUpdate=!0})),p.start()},c=0;c<this.props.settings.sprite_number;c++)o()}},{key:"zoomScaler",value:function(e){return me.c().domain([20,0]).range([this.props.scaleMin,this.props.scaleMax]).clamp(!0)(e)}},{key:"getZFromScale",value:function(e){var t=pe.d.degToRad(this.camera.fov);return this.props.height/e/(2*Math.tan(t/2))}},{key:"getScaleFromZ",value:function(e){var t=pe.d.degToRad(this.camera.fov),a=2*(Math.tan(t/2)*e);return this.props.height/a}},{key:"zoomHandler",value:function(){var e=me.a.transform,t=e.k,a=-(e.x-this.props.width/2)/t,i=(e.y-this.props.height/2)/t,n=this.getZFromScale(t);this.camera.position.set(a,i,n);for(var r=this.zoomScaler(n),s=this.scene.children[0].children,o=0;o<s.length;o++)s[o].material.uniforms.size.value=r}},{key:"setupCamera",value:function(){var e,t=this.props,a=t.width,i=t.height,n=t.embeddings_data,r=this.camera.fov,s=pe.d.degToRad(r),o=n.map((function(e){return e[0]})),c=E.min(o),l=E.max(o),d=n.map((function(e){return e[1]})),h=E.min(d),u=E.max(d),p=E.max([c,l].map((function(e){return Math.abs(e)}))),m=E.max([h,u].map((function(e){return Math.abs(e)}))),v=1.25*(e=Math.max(p,m)/Math.tan(s/2));this.camera.far=v,this.camera.position.z=1.1*e,this.d3_zoom=me.e().scaleExtent([this.getScaleFromZ(v-1),this.getScaleFromZ(.1)]).on("zoom",this.zoomHandler.bind(this));var g=me.d(this.mount);this.view=g,g.call(this.d3_zoom);var f=this.getScaleFromZ(this.camera.position.z),j=me.f.translate(a/2,i/2).scale(f);this.d3_zoom.transform(g,j),this.setState({view:g})}},{key:"addPoints",value:function(){for(var e=this,t=this.props,a=t.embeddings_data,i=t.metadata,n=[],r=0;r<this.props.settings.sprite_number;r++){var s=r*this.sprite_size,o=(r+1)*this.sprite_size;r===this.props.settings.sprite_number-1&&(o=this.props.settings.sprite_number*this.sprite_size),n.push([s,o])}var c,l=n.map((function(e){return a.slice(e[0],e[1])})),d=new pe.k;this.textures=this.tile_locations.map((function(t){var a=d.load(t,function(e){this.setState({tilesLoaded:this.state.tilesLoaded+1})}.bind(e));return a.flipY=!1,a.magFilter=pe.e,a}));for(var h=new pe.c,u=0;u<this.props.settings.sprite_number;u++){for(var p=l[u],m=[],v=0;v<p.length;v++){var g=p[v],f=new pe.m(g[0],g[1],0);m[v]=f}c=new pe.b;var j=m.length,b=new Float32Array(3*j),x=new Float32Array(2*j),O=new Float32Array(3*j),y=new Float32Array(j);c.addAttribute("position",new pe.a(b,3)),c.addAttribute("offset",new pe.a(x,2)),c.addAttribute("filter",new pe.a(y,1)),c.addAttribute("cluster",new pe.a(O,3));for(var _=0,w=0,S=j;_<S;_++,w+=3){var C=p[_][0],k=p[_][1];b[w]=C,b[w+1]=k,b[w+2]=0}for(var P=1/this.props.settings.sprite_side,D=0,A=0,z=j;D<z;D++,A+=2){var F=D%this.props.settings.sprite_side*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size,T=Math.floor(D/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/this.props.settings.sprite_actual_size;x[A]=F,x[A+1]=T}if(this.props.settings.clusters.clusterList)for(var M=this.props.clusterTypeSelected,I=this.props.settings.clusters.clusterColors,N=0,R=0,E=j;N<E;N++,R+=1)if(y[R]=0,"-"!==M&&this.props.settings.clusters.clusterList.includes(M)){var H=i[R][M];H>=I.length?(O[3*R]=1,O[3*R+1]=1,O[3*R+2]=1):(O[3*R]=I[H][0],O[3*R+1]=I[H][1],O[3*R+2]=I[H][2])}var L={texture:{value:this.textures[u]},repeat:{value:new pe.l(P,P)},size:{value:this.props.settings.sprite_image_size},greyTransparency:{value:.1},imageTransparency:{value:1},clusterActive:{value:0}},U=new pe.j({uniforms:L,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        attribute vec3 cluster;\n        varying vec3 vCluster;\n        attribute float filteredActive;\n        varying float vFilteredActive;\n        uniform float clusterActive;\n        varying float vClusterActive;\n        uniform float size;\n        uniform float greyTransparency;\n        varying float vGreyTransparency;\n        uniform float imageTransparency;\n        varying float vImageTransparency;\n\n        void main() {\n          vOffset = offset;\n          vFilteredActive = filteredActive;\n          vCluster = cluster;\n          vClusterActive = clusterActive;\n          vGreyTransparency = greyTransparency;\n          vImageTransparency = imageTransparency;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        varying vec3 vCluster;\n        varying float vClusterActive;\n        varying float vFilteredActive;\n        varying float vGreyTransparency;\n        varying float vImageTransparency;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          // make transparent images\n          if ( tex.a < 0.003 ) discard;\n\n          // Display clusters\n          vec4 replace_color = vec4(vCluster,1.0);\n          vec4 default_border_color = vec4(0.00392156863,0.00392156863,0.00392156863,0.0);\n          vec4 diff = tex - default_border_color;\n          float equality = float(dot(diff,diff) < 0.99 && vClusterActive > 0.9);\n          tex = mix( tex, replace_color, equality);\n           \n          // make transparent images\n          tex = mix( tex,  vec4(0.0,0.0,0.0,0.0), vImageTransparency);\n\n          // Grey images filter our selection \n          vec4 filterout_color = vec4(0.3,0.3,0.3,vGreyTransparency);\n          float filterout_equality = float(vFilteredActive > 0.9);\n          tex = mix( tex, filterout_color, filterout_equality );\n          gl_FragColor = tex; //* vec4(vColor, 1.0);\n        }",transparent:!0}),G=new pe.g(c,U);G.userData={sprite_index:u},this.pointsAr.push(G),h.add(G)}this.scene.add(h)}},{key:"addBlankHighlightPoints",value:function(){var e=new pe.c;this.scene.add(e);var t=[new pe.m(0,0,0)],a=new pe.b,i=t.length,n=new Float32Array(3*i),r=new Float32Array(2*i);a.addAttribute("position",new pe.a(n,3)),a.addAttribute("offset",new pe.a(r,2));var s=1/this.props.settings.sprite_side,o={texture:{value:this.textures[0]},repeat:{value:new pe.l(s,s)},size:{value:84}},c=new pe.j({uniforms:o,vertexShader:"\n        attribute vec2 offset;\n        varying vec2 vOffset;\n        uniform float size;\n        void main() {\n          vOffset = offset;\n          gl_PointSize = size;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"\n        uniform sampler2D texture;\n        uniform vec2 repeat;\n        varying vec2 vOffset;\n        void main() {\n          vec2 uv = vec2( gl_PointCoord.x, gl_PointCoord.y );\n          vec4 tex = texture2D( texture, uv * repeat + vOffset );\n          gl_FragColor = tex;\n        }",transparent:!0}),l=new pe.g(a,c);l.frustumCulled=!1,this.scene.children[1].visible=!1,this.scene.children[1].add(l)}},{key:"highlightPoint",value:function(e,t,a){var i=this.props,n=i.algorithm_choice,r=i.mappings,s=this.scene.children[1].children[0],o=r[n][a],c=[new pe.m(o[0],o[1],0)],l=new Float32Array(2),d=t%this.props.settings.sprite_side*this.props.settings.sprite_image_size/2048,h=Math.floor(t/this.props.settings.sprite_side)*this.props.settings.sprite_image_size/2048;l[0]=d,l[1]=h,s.geometry.attributes.position.copyVector3sArray(c),s.geometry.attributes.position.needsUpdate=!0,s.geometry.attributes.offset.array=l,s.geometry.attributes.offset.needsUpdate=!0,s.material.uniforms.texture.value=this.textures[e]}},{key:"removeHighlights",value:function(){var e=this.scene.children[1],t=e.children;e.remove.apply(e,Object(ue.a)(t))}},{key:"checkIntersects",value:function(e){var t=this.props,a=t.width,i=t.height,n=t.previewPane_ctx,r=t.previewPane_image_size;var s=function(e){var t=Object(y.a)(e,2),n=t[0],r=t[1];return new pe.m(n/a*2-1,-r/i*2+1,1)}(e);this.raycaster.setFromCamera(s,this.camera),this.raycaster.params.Points.threshold=.25;var o=this.raycaster.intersectObjects(this.scene.children[0].children);if(o[0]){var c=function(e){return E.sortBy(e,"distanceToRay")}(o),l=c[0],d=l.object.userData.sprite_index,h=l.index,u=d*this.sprite_size+h;if(void 0===this.filterAr||this.filterAr[u]<1){this.props.setHoverIndex(u),this.highlightPoint(d,h,u),this.scene.children[1].visible=!0,n.clearRect(0,0,r,r),n.fillRect(0,0,r,r),n.fillStyle="transparent";try{n.drawImage(this.datasetIMG[d],h%this.props.settings.sprite_side*this.props.settings.sprite_image_size,Math.floor(h/this.props.settings.sprite_side)*this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,this.props.settings.sprite_image_size,0,0,r,r)}catch(p){console.log("previewPane_ctx.drawImage",p)}}}else this.props.setHoverIndex(null),this.scene.children[1].visible=!1,n.fillRect(0,0,r,r),n.fillStyle="transparent"}},{key:"handleMouse",value:function(){var e=this,t=me.d(this.renderer.domElement);this.raycaster=new pe.h,t.on("mousemove",(function(){var a=me.b(t.node()),i=Object(y.a)(a,2),n=[i[0],i[1]];e.checkIntersects(n)})),t.on("dblclick",(function(){e.scene.children[1].visible&&e.props.clickOnImage()}))}},{key:"init",value:function(){var e=this.props,t=e.width,a=e.height;this.scene=new pe.i;var i=t/a;this.camera=new pe.f(75,i,.01,1e3),this.renderer=new pe.n({preserveDrawingBuffer:!0,alpha:!0}),this.renderer.setClearColor(16777215,0),this.renderer.autoClear=!1,this.renderer.setSize(t,a),this.renderer.domElement.id="threeCanvas",this.mount.appendChild(this.renderer.domElement),this.addPoints(),this.addBlankHighlightPoints(),this.setupCamera(),this.animate(),this.handleMouse(),this.changeEmbeddings(this.props.algorithm_choice)}},{key:"animate",value:function(){requestAnimationFrame(this.animate),ve.c(),this.renderer.clear(),0===parseInt(this.props.greyRenderTypeSelected)&&(this.updatePass2Shader(1),this.renderer.render(this.scene,this.camera)),this.updatePass2Shader(2),this.renderer.render(this.scene,this.camera)}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.width,i=t.height;a===e.width&&i===e.height||this.handleResize(a,i),e.algorithm_choice!==this.props.algorithm_choice&&this.changeEmbeddings(this.props.algorithm_choice),this.props.scaleMin===e.scaleMin&&this.props.scaleMax===e.scaleMax||this.handleResize(a,i)}},{key:"componentWillUnmount",value:function(){this.mount.removeChild(this.renderer.domElement)}},{key:"render",value:function(){var e=this,t=this.props,a=t.width,i=t.height,n=this.state.tilesLoaded,r=this.props.settings.sprite_number;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("div",{children:n<1?Object(v.jsxs)("div",{className:"loading",children:[Object(v.jsx)(ge.a,{color:"inherit"}),Object(v.jsx)("div",{children:"loading tiles..."})]}):n<r-1?Object(v.jsxs)("div",{className:"loading-small",children:[Object(v.jsx)(ge.a,{color:"inherit"}),Object(v.jsx)("div",{children:"loading..."})]}):""}),Object(v.jsx)("div",{style:{width:a,height:i,overflow:"hidden"},ref:function(t){e.mount=t}})]})}}]),a}(i.Component),je=n.a.memo(fe),be=a(33),xe=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;Object(l.a)(this,a),(i=t.call(this,e)).calculateProjection=function(e,t,a){var n,r,s;"filter"===t&&(i.setState({currentFilter:e}),n=e,r=i.state.currentSearch),"search"===t&&(i.setState({currentSearch:e}),n=i.state.currentFilter,r=e),a?(s=n.map((function(e,t){return e+r[t]})),i.setState({currentProjection:s})):s=e;try{i.refProjection.current.updateProjection(s)}catch(o){}},i.toggleControl=function(){i.setState({collapsedControl:!i.state.collapsedControl})},i.toggleObject=function(){i.setState({collapsedObject:!i.state.collapsedObject})};var r=i.props.settings.total;return i.state={ww:null,wh:null,hover_index:0,previewPane_height:null,controlPane_height:null,filterPane_height:null,algorithm_choice:null,allFilter:{},currentProjection:new Float32Array(r).fill(0),currentFilter:new Float32Array(r).fill(0),currentSearch:new Float32Array(r).fill(0),scaleMin:14,scaleMax:70,filterGrey:!0,clusterTypeSelected:"-",greyRenderTypeSelected:0,dimensions:{},collapsedControl:!1,collapsedObject:!1},i.previewPane_ctx=null,i.setSize=E.debounce(i.setSize.bind(Object(m.a)(i)),200),i.setPreviewPaneCanvas=i.setPreviewPaneCanvas.bind(Object(m.a)(i)),i.setPreviewImage=i.setPreviewImage.bind(Object(m.a)(i)),i.selectAlgorithm=i.selectAlgorithm.bind(Object(m.a)(i)),i.selectDataset=i.selectDataset.bind(Object(m.a)(i)),i.toggleControl=i.toggleControl.bind(Object(m.a)(i)),i.refProjection=n.a.createRef(),i}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.setDefaults(),this.selectAlgorithm(this.props.algorithm_name),this.setSize(),window.addEventListener("resize",this.setSize)}},{key:"setDefaults",value:function(){this.props.settings.total<2e4?this.setState({scaleMin:15,filterGrey:!0,greyRenderTypeSelected:0}):this.setState({scaleMin:5,filterGrey:!1,greyRenderTypeSelected:1})}},{key:"setRenderer",value:function(e){this.setState({renderer:e})}},{key:"handleChangeScale",value:function(e,t){this.setState({scaleMin:t})}},{key:"handleChangeZoom",value:function(e,t){this.setState({scaleMax:t})}},{key:"handleChangeCluster",value:function(e){var t=e.target.value;this.setState({clusterTypeSelected:parseInt(t)}),console.log(e.target);try{this.refProjection.current.updateClusterColors(t)}catch(a){console.log("error updateClusterColors")}}},{key:"handleChangeGrey",value:function(e){this.setState({greyRenderTypeSelected:e})}},{key:"selectAlgorithm",value:function(e){var t=this.props.algorithm_options.indexOf(e);t<0&&(t=0),this.setState({algorithm_choice:t}),this.props.addToUrl("projection",this.props.algorithm_options[t])}},{key:"selectDataset",value:function(e){this.props.changeDataset(e)}},{key:"setSize",value:function(){this.setState({ww:window.innerWidth,wh:window.innerHeight});var e=this.previewPane_mount.offsetHeight;this.setState({previewPane_height:e}),this.previewPane_ctx&&(this.previewPane_ctx.imageSmoothingEnabled=!1),window.innerWidth<900?this.setState({collapsedControl:!0,collapsedObject:!0}):this.setState({collapsedControl:!1,collapsedObject:!1})}},{key:"setPreviewPaneCanvas",value:function(e){var t=e.getContext("2d");t.imageSmoothingEnabled=!1,this.previewPane_ctx=t,console.log(t)}},{key:"setPreviewImage",value:function(){return Object(v.jsx)("img",{src:this.props.settings.url_prefix+this.props.metadata[this.state.hover_index].filename,alt:"preview",style:{verticalAlign:"middle"}})}},{key:"setHoverIndex",value:function(e){e&&this.setState({hover_index:e})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setSize)}},{key:"clickOnImage",value:function(){console.log("open image",this.state.hover_index);try{var e=this.props.metadata[this.state.hover_index].link_URL;window.open(e,"_blank","noopener,noreferrer")}catch(t){}}},{key:"render",value:function(){for(var e=this,t=this.props,a=t.embeddings_data,i=t.mappings,n=t.algorithm_options,r=t.dataset_options,s=t.metadata,o=t.settings,c=t.barData,l=this.state,d=l.ww,h=l.wh,u=l.hover_index,p=l.algorithm_choice,m=l.currentProjection,g=l.allFilter,j=l.greyRenderTypeSelected,b=l.clusterTypeSelected,x=l.collapsedControl,O=l.collapsedObject,y=this.previewPane_ctx,_={position:"relative",background:"#111",overflow:"hidden",width:d,height:h},w="320px",S={fontSize:16,lineHeight:1.5},C=0,k=0;k<o.total;k++)0===m[k]&&C++;return null!==d?Object(v.jsxs)("div",{style:S,children:[Object(v.jsx)("div",{style:{position:"absolute",right:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#222",zIndex:8},ref:function(t){e.controlMenu_mount=t},children:Object(v.jsx)("div",{children:Object(v.jsx)(he.c,{collapsed:x,children:Object(v.jsxs)(he.a,{iconShape:"square",children:[Object(v.jsxs)(he.b,{children:[Object(v.jsx)("h3",{}),Object(v.jsx)("a",{className:"collapseCon",onClick:this.toggleControl,children:x?Object(v.jsx)(be.a,{}):Object(v.jsx)(be.b,{})})]}),Object(v.jsx)(he.d,{defaultOpen:!0,title:x?null:"Data & Projections",icon:x?Object(v.jsx)(be.d,{}):null,children:Object(v.jsx)(he.b,{children:Object(v.jsx)(ie,{grem:24,algorithm_options:n,algorithm_choice:p,selectAlgorithm:this.selectAlgorithm,dataset_options:r,selectDataset:this.selectDataset,selectedDataset:this.props.selectedDataset,datasetInfo:o.datasetInfo})})}),Object(v.jsx)(he.d,{defaultOpen:!0,title:x?null:"Dimension Filters",icon:x?Object(v.jsx)(be.j,{}):null,children:Object(v.jsx)(he.b,{children:Object(v.jsx)(R,{grem:24,metadata:s,hover_index:u,settings:o,barData:c,calculateProjection:this.calculateProjection,currentProjection:m,allFilter:g})})}),Object(v.jsx)(he.d,{title:x?null:"Advanced Filters",icon:x?Object(v.jsx)(be.i,{}):null,children:Object(v.jsx)(he.b,{children:Object(v.jsx)(q,{grem:24,calculateProjection:this.calculateProjection,hover_index:u,settings:o,metadata:s,currentProjection:m,allFilter:g})})}),Object(v.jsx)(he.d,{title:x?null:"Export Filtered Data",icon:x?Object(v.jsx)(be.c,{}):null,children:Object(v.jsx)(he.b,{children:Object(v.jsx)(de,{metadata:s,currentProjection:m})})})]})})})}),Object(v.jsx)("div",{style:{position:"absolute",left:0,top:0,height:"auto",maxHeight:"100vh",overflow:"auto",background:"#222",zIndex:8},ref:function(t){e.previewPane_mount=t},children:Object(v.jsx)("div",{children:Object(v.jsx)(he.c,{collapsed:O,children:Object(v.jsxs)(he.a,{iconShape:"square",children:[Object(v.jsxs)(he.b,{children:[O?Object(v.jsx)("h3",{}):Object(v.jsx)("h3",{children:"Collection Space Navigator"}),Object(v.jsx)("a",{className:"collapseObj",onClick:this.toggleObject,children:O?Object(v.jsx)(be.b,{}):Object(v.jsx)(be.a,{})})]}),Object(v.jsx)(he.d,{defaultOpen:!0,title:O?null:"Object Preview",icon:O?Object(v.jsx)(be.h,{}):null,children:Object(v.jsx)(f,{previewPane_image_size:w,setPreviewPaneCanvas:this.setPreviewPaneCanvas,setPreviewImage:this.setPreviewImage,hover_index:u})}),Object(v.jsx)(he.d,{defaultOpen:!0,title:O?null:"Object Info",icon:O?Object(v.jsx)(be.f,{}):null,children:Object(v.jsx)(he.b,{children:Object(v.jsx)($,{hover_index:u,metadata:s,infos:o.info})})}),Object(v.jsxs)(he.d,{title:O?null:"Object Appearance",icon:O?Object(v.jsx)(be.e,{}):null,children:[Object(v.jsx)(he.b,{children:Object(v.jsx)(te,{clusters:o.clusters,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,filterGrey:this.state.filterGrey,handleChangeScale:this.handleChangeScale.bind(this),handleChangeZoom:this.handleChangeZoom.bind(this),handleChangeCluster:this.handleChangeCluster.bind(this),handleChangeGrey:this.handleChangeGrey.bind(this),total:o.total})}),Object(v.jsx)(he.b,{children:Object(v.jsxs)("div",{className:"info",children:["showing ",C," / ",o.total]})})]}),Object(v.jsx)(he.d,{title:O?null:"About",icon:O?Object(v.jsx)(be.g,{}):null,children:Object(v.jsxs)("div",{className:"about",children:["The Collection Space Navigator (CSN) is an ",Object(v.jsx)("strong",{children:"interactive visualization interface for multidimensional datasets"}),". It functions as an explorative visualization tool for researching collections and their multidimensional representations. We designed this tool to better understand multidimensional data, its methods, and semantic qualities through spatial navigation and filtering. CSN can be used with any image collection and can be customized for specific research needs. ",Object(v.jsx)("a",{href:"https://github.com/Collection-Space-Navigator/CSN",target:"_blank",rel:"noreferrer",children:Object(v.jsx)("strong",{children:"[more on GitHub...]"})})]})})]})})})}),Object(v.jsx)("div",{style:_,children:Object(v.jsx)(je,{ref:this.refProjection,width:_.width,height:_.height,embeddings_data:a,mappings:i,metadata:s,previewPane_ctx:y,previewPane_image_size:w,setHoverIndex:this.setHoverIndex.bind(this),algorithm_choice:p,datasetDir:this.props.datasetDir,clusterTypeSelected:b,greyRenderTypeSelected:j,settings:o,initPath:this.props.initPath,scaleMin:this.state.scaleMin,scaleMax:this.state.scaleMax,currentProjection:m,clickOnImage:this.clickOnImage.bind(this)})})]}):Object(v.jsxs)("div",{className:"loading",children:[Object(v.jsx)(ge.a,{color:"inherit"}),Object(v.jsx)("div",{children:"loading layout..."})]})}}]),a}(i.Component),Oe=a(70),ye=a.n(Oe);var _e,we=function(e){Object(h.a)(a,e);var t=Object(u.a)(a);function a(e){var i;return Object(l.a)(this,a),(i=t.call(this,e)).state={algorithm_options:null,dataset_options:null,dataset_dirs:null,embeddings_data:null,mappings:null,metadata:null,defaultDataset:null,algorithm_name:0},i}return Object(d.a)(a,[{key:"scaleEmbeddings",value:function(e){var t=e.map((function(e){return Math.abs(e[0])})),a=e.map((function(e){return Math.abs(e[1])})),i=E.max(t),n=E.max(a),r=Math.max(i,n),s=me.c().domain([-r,r]).range([-20,20]);return e.map((function(e){return[s(e[0]),s(e[1])]}))}},{key:"componentDidMount",value:function(){var e=window.location.search,t=new URLSearchParams(e);this.setState({selectedDataset:t.get("dataset")}),void 0!==t.get("projection")&&this.setState({algorithm_name:t.get("projection")}),this.loadInit("datasets/datasets_config.json")}},{key:"loadConfig",value:function(e){this.loadSettings("datasets/".concat(e,"/config.json")),this.loadBarData("datasets/".concat(e,"/barData.json")),this.loadMetadata("datasets/".concat(e,"/metadata.json"))}},{key:"prepareMappings",value:function(e){var t=[];for(var a in this.state.settings.embeddings)console.log(this.state.settings.embeddings[a].name),t[a]=this.state.settings.embeddings[a].name;this.setState({algorithm_options:t})}},{key:"loadDataset",value:function(e){var t=this,a=[],i=this.state.settings.embeddings,n=function(e){fetch("".concat("/CSN","/datasets/").concat(t.state.datasetDir,"/").concat(i[e].file)).then((function(e){return e.json()})).then((function(t){var i=t;a[e]=i})).then((function(){t.setState({mappings:a,embeddings_data:a[0]})}))};for(var r in i)n(r)}},{key:"addToUrl",value:function(e,t){var a=window.location.search,i=new URLSearchParams(a);i.set(e,t),this.props.navigate("?"+i.toString())}},{key:"prepareDatasets",value:function(e){var t=[],a=[];for(var i in this.state.settings.embeddings)console.log(this.state.settings.embeddings[i].name),t[i]=this.state.settings.embeddings[i].name,a[i]=this.state.settings.embeddings[i].directory;this.setState({dataset_options:t,dataset_dirs:a})}},{key:"changeDataset",value:function(e){this.addToUrl("dataset",e);var t=this.state.dataset_options.indexOf(e),a=this.state.dataset_dirs[t];this.setState({selectedDataset:e,datasetDir:a,algorithm_options:null,embeddings_data:null,mappings:null,metadata:null}),this.loadConfig(a)}},{key:"loadInit",value:function(e){var t=this;fetch("".concat("/CSN","/")+e).then((function(e){return e.json()})).then((function(e){var a=[],i=[];for(var n in e.data)console.log(e.data[n].directory),a[n]=e.data[n].name,i[n]=e.data[n].directory;if(t.setState({dataset_options:a,dataset_dirs:i}),null===t.state.selectedDataset)t.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory}),t.addToUrl("dataset",e.data[e.default].name);else{var r=!1;for(var s in e.data)e.data[s].name===t.state.selectedDataset&&(t.setState({datasetDir:e.data[s].directory}),r=!0);r||t.setState({selectedDataset:e.data[e.default].name,datasetDir:e.data[e.default].directory})}})).then((function(){return t.loadConfig(t.state.datasetDir)}))}},{key:"loadSettings",value:function(e){var t=this;fetch("".concat("/CSN","/")+e).then((function(e){return e.json()})).then((function(e){try{var a=e.clusters.clusterColors.map((function(e){return[ye()(e).rgb().array()[0]/255,ye()(e).rgb().array()[1]/255,ye()(e).rgb().array()[2]/255]}));e.clusters.clusterColors=a}catch(i){}t.setState({settings:e})})).then((function(){return t.prepareMappings(0)})).then((function(){return t.loadDataset(0)}))}},{key:"loadMetadata",value:function(e){var t=this;fetch("".concat("/CSN","/")+e).then((function(e){return e.json()})).then((function(e){return t.setState({metadata:e})}))}},{key:"loadBarData",value:function(e){var t=this;fetch("".concat("/CSN","/")+e).then((function(e){return e.json()})).then((function(e){return t.setState({barData:e})}))}},{key:"render",value:function(){return this.state.embeddings_data&&this.state.metadata?Object(v.jsx)(xe,Object(p.a)(Object(p.a)({},this.state),{},{addToUrl:this.addToUrl.bind(this),algorithm_name:this.state.algorithm_name,algorithm_options:this.state.algorithm_options,dataset_options:this.state.dataset_options,dataset_dirs:this.state.dataset_dirs,changeDataset:this.changeDataset.bind(this),selectedDataset:this.state.selectedDataset,datasetDir:this.state.datasetDir})):Object(v.jsxs)("div",{className:"loading",children:[Object(v.jsx)(ge.a,{color:"inherit"}),Object(v.jsx)("div",{children:"loading datasets... "})]})}}]),a}(i.Component),Se=(_e=we,function(e){return Object(v.jsx)(_e,Object(p.a)(Object(p.a)({},e),{},{params:Object(c.p)(),navigate:Object(c.n)()}))});function Ce(){return Object(v.jsx)(o.a,{children:Object(v.jsxs)(c.c,{children:[Object(v.jsx)(c.a,{exact:!0,path:"/",element:Object(v.jsx)(Se,{})}),Object(v.jsx)(c.a,{exact:!0,path:"/CSN",element:Object(v.jsx)(Se,{})})]})})}var ke=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Pe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(Object(v.jsx)(Ce,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/CSN",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/CSN","/service-worker.js");ke?(!function(e,t){fetch(e).then((function(a){var i=a.headers.get("content-type");404===a.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Pe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")}))):Pe(t,e)}))}}()}},[[144,1,2]]]);
//# sourceMappingURL=main.e0602696.chunk.js.map